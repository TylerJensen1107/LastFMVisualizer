/*!
 * jQuery Popup Overlay
 *
 * @version 1.8.0
 * @requires jQuery v1.7.1+
 * @link http://vast-engineering.github.com/jquery-popup-overlay/
 */

!function(t){var e,o,i=t(window),n={},a=[],p=[],s=null,l="_open",r="_close",d=[],c=null,u=/(iPad|iPhone|iPod)/g.test(navigator.userAgent),f={_init:function(e){var o=t(e),i=o.data("popupoptions");p[e.id]=!1,a[e.id]=0,o.data("popup-initialized")||(o.attr("data-popup-initialized","true"),f._initonce(e)),i.autoopen&&setTimeout(function(){f.show(e,0)},0)},_initonce:function(o){var i=t(o),n=t("body"),a=i.data("popupoptions");if(s=parseInt(n.css("margin-right"),10),c=void 0!==document.body.style.webkitTransition||void 0!==document.body.style.MozTransition||void 0!==document.body.style.msTransition||void 0!==document.body.style.OTransition||void 0!==document.body.style.transition,"tooltip"==a.type&&(a.background=!1,a.scrolllock=!1),a.backgroundactive&&(a.background=!1,a.blur=!1,a.scrolllock=!1),a.scrolllock){var p,r;"undefined"==typeof e&&(p=t('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body"),r=p.children(),e=r.innerWidth()-r.height(99).innerWidth(),p.remove())}i.attr("id")||i.attr("id","j-popup-"+parseInt(1e8*Math.random(),10)),i.addClass("popup_content"),i.css({opacity:0,visibility:"hidden",display:"inline-block"}),a.outline||i.css("outline","none"),a.transition&&i.css("transition",a.transition),i.attr("aria-hidden",!0),"overlay"==a.type&&i.css({textAlign:"left",position:"relative",verticalAlign:"middle"}),i.attr("role","dialog");var d=a.openelement?a.openelement:"."+o.id+l;t(d).each(function(e,o){t(o).attr("data-popup-ordinal",e),o.id||t(o).attr("id","open_"+parseInt(1e8*Math.random(),10))}),i.attr("aria-labelledby")||i.attr("aria-label")||i.attr("aria-labelledby",t(d).attr("id")),"hover"==a.action?(a.keepfocus=!1,t(d).on("mouseenter",function(e){f.show(o,t(this).data("popup-ordinal"))}),t(d).on("mouseleave",function(t){f.hide(o)})):t(document).on("click",d,function(e){e.preventDefault();var i=t(this).data("popup-ordinal");setTimeout(function(){f.show(o,i)},0)}),a.closebutton&&f.addclosebutton(o),a.detach?i.detach():$wrapper.hide()},show:function(n,l){var v=t(n);if(!v.data("popup-visible")){v.data("popup-initialized")||f._init(n),v.attr("data-popup-initialized","true");var g=t("body"),b=v.data("popupoptions"),m=t("#"+n.id+"_background");if(g.prepend(n),v.wrap('<div id="'+n.id+'_wrapper" class="popup_wrapper" />'),$wrapper=t("#"+n.id+"_wrapper"),$wrapper.css({opacity:0,visibility:"hidden",position:"absolute"}),u&&$wrapper.css("cursor","pointer"),b.setzindex&&!b.autozindex&&$wrapper.css("z-index","100001"),b.transition&&$wrapper.css("transition",b.transition),"overlay"==b.type&&$wrapper.css("overflow","auto"),"overlay"==b.type&&(css={position:"fixed",width:"100%",height:"100%",top:0,left:0,textAlign:"center"},b.backgroundactive&&(css.position="relative",css.height="0",css.overflow="visible"),$wrapper.css(css),$wrapper.append('<div class="popup_align" />'),t(".popup_align").css({display:"inline-block",verticalAlign:"middle",height:"100%"})),b.background&&!t("#"+n.id+"_background").length){g.prepend('<div id="'+n.id+'_background" class="popup_background"></div>');var m=t("#"+n.id+"_background");m.css({opacity:0,visibility:"hidden",backgroundColor:b.color,position:"fixed",top:0,right:0,bottom:0,left:0}),b.setzindex&&!b.autozindex&&m.css("z-index","100000"),b.transition&&m.css("transition",b.transition)}if(h(n,l,b.beforeopen),p[n.id]=l,setTimeout(function(){d.push(n.id)},0),b.autozindex){for(var y=document.getElementsByTagName("*"),w=y.length,_=0,k=0;w>k;k++){var $=t(y[k]).css("z-index");"auto"!==$&&($=parseInt($,10),$>_&&(_=$))}a[n.id]=_,b.background&&a[n.id]>0&&t("#"+n.id+"_background").css({zIndex:a[n.id]+1}),a[n.id]>0&&$wrapper.css({zIndex:a[n.id]+2})}b.detach?($wrapper.prepend(n),v.show()):$wrapper.show(),o=setTimeout(function(){$wrapper.css({visibility:"visible",opacity:1}),t("html").addClass("popup_visible").addClass("popup_visible_"+n.id),$wrapper.addClass("popup_wrapper_visible")},20),b.scrolllock&&(g.css("overflow","hidden"),g.height()>i.height()&&g.css("margin-right",s+e)),b.backgroundactive&&v.css({top:(i.height()-(v.get(0).offsetHeight+parseInt(v.css("margin-top"),10)+parseInt(v.css("margin-bottom"),10)))/2+"px"}),v.css({visibility:"visible",opacity:1}),b.background&&(m.css({visibility:"visible",opacity:b.opacity}),setTimeout(function(){m.css({opacity:b.opacity})},0)),v.data("popup-visible",!0),f.reposition(n,l),v.data("focusedelementbeforepopup",document.activeElement),b.keepfocus&&(v.attr("tabindex",-1),setTimeout(function(){"closebutton"===b.focuselement?t("#"+n.id+" ."+n.id+r+":first").focus():b.focuselement?t(b.focuselement).focus():v.focus()},b.focusdelay)),t(b.pagecontainer).attr("aria-hidden",!0),v.attr("aria-hidden",!1),h(n,l,b.onopen),c?$wrapper.one("transitionend",function(){h(n,l,b.opentransitionend)}):h(n,l,b.opentransitionend)}},hide:function(e){o&&clearTimeout(o);var i=t("body"),n=t(e),a=n.data("popupoptions"),l=t("#"+e.id+"_wrapper"),r=t("#"+e.id+"_background");n.data("popup-visible",!1),1===d.length?t("html").removeClass("popup_visible").removeClass("popup_visible_"+e.id):t("html").hasClass("popup_visible_"+e.id)&&t("html").removeClass("popup_visible_"+e.id),d.pop(),l.hasClass("popup_wrapper_visible")&&l.removeClass("popup_wrapper_visible"),a.keepfocus&&setTimeout(function(){t(n.data("focusedelementbeforepopup")).is(":visible")&&n.data("focusedelementbeforepopup").focus()},0),l.css({visibility:"hidden",opacity:0}),n.css({visibility:"hidden",opacity:0}),a.background&&r.css({visibility:"hidden",opacity:0}),t(a.pagecontainer).attr("aria-hidden",!1),n.attr("aria-hidden",!0),h(e,p[e.id],a.onclose),c&&"0s"!==n.css("transition-duration")?n.one("transitionend",function(t){n.data("popup-visible")||(a.detach?(l.detach(),r.detach()):l.hide()),a.scrolllock&&setTimeout(function(){i.css({overflow:"visible","margin-right":s})},10),h(e,p[e.id],a.closetransitionend)}):(a.detach?(l.detach(),r.detach()):l.hide(),a.scrolllock&&setTimeout(function(){i.css({overflow:"visible","margin-right":s})},10),h(e,p[e.id],a.closetransitionend))},toggle:function(e,o){t(e).data("popup-visible")?f.hide(e):setTimeout(function(){f.show(e,o)},0)},reposition:function(e,o){var n=t(e),a=n.data("popupoptions"),p=t("#"+e.id+"_wrapper");t("#"+e.id+"_background");if(o=o||0,"tooltip"==a.type){p.css({position:"absolute"});var s;s=a.tooltipanchor?t(a.tooltipanchor):a.openelement?t(a.openelement).filter('[data-popup-ordinal="'+o+'"]'):t("."+e.id+l+'[data-popup-ordinal="'+o+'"]');var r=s.offset();"right"==a.horizontal?p.css("left",r.left+s.outerWidth()+a.offsetleft):"leftedge"==a.horizontal?p.css("left",r.left+s.outerWidth()-s.outerWidth()+a.offsetleft):"left"==a.horizontal?p.css("right",i.width()-r.left-a.offsetleft):"rightedge"==a.horizontal?p.css("right",i.width()-r.left-s.outerWidth()-a.offsetleft):p.css("left",r.left+s.outerWidth()/2-n.outerWidth()/2-parseFloat(n.css("marginLeft"))+a.offsetleft),"bottom"==a.vertical?p.css("top",r.top+s.outerHeight()+a.offsettop):"bottomedge"==a.vertical?p.css("top",r.top+s.outerHeight()-n.outerHeight()+a.offsettop):"top"==a.vertical?p.css("bottom",i.height()-r.top-a.offsettop):"topedge"==a.vertical?p.css("bottom",i.height()-r.top-n.outerHeight()-a.offsettop):p.css("top",r.top+s.outerHeight()/2-n.outerHeight()/2-parseFloat(n.css("marginTop"))+a.offsettop)}else"overlay"==a.type&&(a.horizontal?p.css("text-align",a.horizontal):p.css("text-align","center"),a.vertical?n.css("vertical-align",a.vertical):n.css("vertical-align","middle"))},addclosebutton:function(e){var o;o=t(e).data("popupoptions").closebuttonmarkup?t(n.closebuttonmarkup).addClass(e.id+"_close"):'<button class="popup_close '+e.id+'_close" title="Close" aria-label="Close"><span aria-hidden="true">Ã—</span></button>',$el.data("popup-initialized")&&$el.append(o)}},h=function(e,o,i){var n=t(e).data("popupoptions"),a=n.openelement?n.openelement:"."+e.id+l,p=t(a+'[data-popup-ordinal="'+o+'"]');"function"==typeof i&&i.call(t(e),e,p)};t(document).on("keydown",function(e){if(d.length){var o=d[d.length-1],i=document.getElementById(o);t(i).data("popupoptions").escape&&27==e.keyCode&&f.hide(i)}}),t(document).on("click",function(e){if(d.length){var o=d[d.length-1],i=document.getElementById(o),n=t(i).data("popupoptions").closeelement?t(i).data("popupoptions").closeelement:"."+i.id+r;t(e.target).closest(n).length&&(e.preventDefault(),f.hide(i)),t(i).data("popupoptions").blur&&!t(e.target).closest("#"+o).length&&2!==e.which&&t(e.target).is(":visible")&&(f.hide(i),"overlay"===t(i).data("popupoptions").type&&e.preventDefault())}}),t(document).on("focusin",function(e){if(d.length){var o=d[d.length-1],i=document.getElementById(o);t(i).data("popupoptions").keepfocus&&(i.contains(e.target)||(e.stopPropagation(),i.focus()))}}),t.fn.popup=function(e){return this.each(function(){if($el=t(this),"object"==typeof e){var o=t.extend({},t.fn.popup.defaults,e);$el.data("popupoptions",o),n=$el.data("popupoptions"),f._init(this)}else"string"==typeof e?($el.data("popupoptions")||($el.data("popupoptions",t.fn.popup.defaults),n=$el.data("popupoptions")),f[e].call(this,this)):($el.data("popupoptions")||($el.data("popupoptions",t.fn.popup.defaults),n=$el.data("popupoptions")),f._init(this))})},t.fn.popup.destroyall=function(){t(".popup_wrapper").remove(),t(".popup_background").remove(),d=[]},t.fn.popup.defaults={type:"overlay",autoopen:!1,background:!0,backgroundactive:!1,color:"black",opacity:"0.5",horizontal:"center",vertical:"middle",offsettop:0,offsetleft:0,escape:!0,blur:!0,setzindex:!0,autozindex:!1,scrolllock:!1,closebutton:!1,closebuttonmarkup:null,keepfocus:!0,focuselement:null,focusdelay:50,outline:!1,pagecontainer:null,detach:!0,openelement:null,closeelement:null,transition:null,tooltipanchor:null,beforeopen:null,onclose:null,onopen:null,opentransitionend:null,closetransitionend:null}}(jQuery);