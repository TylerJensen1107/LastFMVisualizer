/*
 MIT License (c) copyright 2011-2013 original author or authors  MIT License (c) copyright 2011-2013 original author or authors */
var BSM;
(function(){if(!BSM||!BSM.requirejs){BSM?d=BSM:BSM={};var f,d,e;(function(b){function h(a,l){var k,g,m,c,b,q,p,d,e,h=l&&l.split("/"),t=v.map,f=t&&t["*"]||{};if(a&&"."===a.charAt(0))if(l){h=h.slice(0,h.length-1);a=h.concat(a.split("/"));for(d=0;d<a.length;d+=1)if(k=a[d],"."===k)a.splice(d,1),--d;else if(".."===k)if(1!==d||".."!==a[2]&&".."!==a[0])0<d&&(a.splice(d-1,2),d-=2);else break;a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((h||f)&&t){k=a.split("/");for(d=k.length;0<d;--d){g=k.slice(0,
d).join("/");if(h)for(e=h.length;0<e;--e)if(m=t[h.slice(0,e).join("/")])if(m=m[g]){c=m;b=d;break}if(c)break;!q&&f&&f[g]&&(q=f[g],p=d)}!c&&q&&(c=q,b=p);c&&(k.splice(0,b,c),a=k.join("/"))}return a}function c(a,l){return function(){return q.apply(b,A.call(arguments,0).concat([a,l]))}}function g(a){return function(l){return h(l,a)}}function a(a){return function(l){r[a]=l}}function m(a){if(w.call(u,a)){var l=u[a];delete u[a];y[a]=!0;k.apply(b,l)}if(!w.call(r,a)&&!w.call(y,a))throw Error("No "+a);return r[a]}
function p(a){var l,k=a?a.indexOf("!"):-1;-1<k&&(l=a.substring(0,k),a=a.substring(k+1,a.length));return[l,a]}function l(a){return function(){return v&&v.config&&v.config[a]||{}}}var k,q,t,n,r={},u={},v={},y={},w=Object.prototype.hasOwnProperty,A=[].slice;t=function(a,l){var k,c=p(a),b=c[0];a=c[1];b&&(b=h(b,l),k=m(b));b?a=k&&k.normalize?k.normalize(a,g(l)):h(a,l):(a=h(a,l),c=p(a),b=c[0],a=c[1],b&&(k=m(b)));return{f:b?b+"!"+a:a,n:a,pr:b,p:k}};n={require:function(a){return c(a)},exports:function(a){var l=
r[a];return"undefined"!==typeof l?l:r[a]={}},module:function(a){return{id:a,uri:"",exports:r[a],config:l(a)}}};k=function(l,k,g,q){var d,p,e,h,f=[],v;q=q||l;if("function"===typeof g){k=!k.length&&g.length?["require","exports","module"]:k;for(h=0;h<k.length;h+=1)if(e=t(k[h],q),p=e.f,"require"===p)f[h]=n.require(l);else if("exports"===p)f[h]=n.exports(l),v=!0;else if("module"===p)d=f[h]=n.module(l);else if(w.call(r,p)||w.call(u,p)||w.call(y,p))f[h]=m(p);else if(e.p)e.p.load(e.n,c(q,!0),a(p),{}),f[h]=
r[p];else throw Error(l+" missing "+p);k=g.apply(r[l],f);l&&(d&&d.exports!==b&&d.exports!==r[l]?r[l]=d.exports:k===b&&v||(r[l]=k))}else l&&(r[l]=g)};f=d=q=function(a,l,g,c,d){if("string"===typeof a)return n[a]?n[a](l):m(t(a,l).f);a.splice||(v=a,l.splice?(a=l,l=g,g=null):a=b);"function"===typeof g&&(g=c,c=d);k(b,a,l||function(){},g);return q};q.config=function(a){v=a;v.deps&&q(v.deps,v.callback);return q};f._defined=r;e=function(a,l,k){l.splice||(k=l,l=[]);w.call(r,a)||w.call(u,a)||(u[a]=[a,l,k])};
e.amd={jQuery:!0}})();BSM.requirejs=f;BSM.require=d;BSM.define=e}})();BSM.require.config({baseUrl:function(){}(),packages:[{name:"when",main:"when",location:"node_modules/when"}]});BSM.define("utils/objects",[],function(){return{$isArray:function(f){return"[object Array]"===Object.prototype.toString.call(f)},$isObject:function(f){return null!=f&&"object"===typeof f}}});
BSM.define("settings/config",["utils/objects"],function(f){function d(c,g){this._masterConfig=c;this._base=g||""}function e(c,g,a){var m;0>c.indexOf("/")?(m=a[c])&&"object"===typeof m&&!f.$isArray(m)?a[c]=b(g,m):a[c]=g:(c=c.split("/"),m=c.shift(),a[m]=a[m]||{},e(c.join("/"),g,a[m]));return a}function b(c,g){c=c||{};g=g||{};var a={},m,d,l,k,q;for(q in c)f.$isArray(c[q])?g[q]=c[q].slice():("object"===typeof c[q]&&c[q]&&null==g[q]&&(g[q]={}),a[q]="object"===typeof c[q]&&c[q]?b(c[q],g[q]):q in g?g[q]:
c[q]);for(q in g){m=a;d=q.split("/");for(k=d.pop();l=d.shift();)m=m[l]=m[l]||{};f.$isArray(g[q])||"object"!==typeof g[q]?m[k]=g[q]:"object"===typeof g[q]&&(m[k]=b(g[q],m[k]))}return a}function h(c){return"string"===typeof c?c:c?f.$isArray(c)?c.join("/"):"":""}d.DELIMITER="/";d.createRoot=function(c,g){var a=b(c,g);return new d(a)};d.explode=function(c,g){var a=g||{},m;for(m in c)e(m,c[m],a);return b(a,g)};d.prototype={_base:"",_masterConfig:null,get:function(c){var g=this._base,a=this._masterConfig;
c=h(c);for(g=(g+"/"+c).split("/");a&&g.length;)if(g[0]||g.shift())a="object"===typeof a&&g[0]in a?a[g.shift()]:null;g=g.length?null:a;return g&&"object"===typeof g?g.slice?g.slice(0):b(g):g},namespace:function(c){c=h(c);c=0===c.indexOf("/")?c:this._base+"/"+c;return new d(this._masterConfig,c)},set:function(c,g){for(var a=this._base,b=this._masterConfig,d=h(c),a=(a+"/"+d).split("/"),d=a.pop(),l;a.length;)if(l=a.shift())b[l]||(b[l]={}),b=b[l];b[d]=g;return this},defined:function(b){return null!==this.get(b)},
fork:function(b){return d.createRoot(this._masterConfig,b)},explode:d.explode};return d});
BSM.define("settings/default",[],function(){return{debug:!1,cdn:"//cdn.beanstock.com/pub",version:"v3.0.2-0-07f064e",ghostwriter:{url:"//cdn.beanstock.com/pub/gw.min.js"},auction:{update_manifest:{cache_key_prefix:"cx/slot/manifest"},default_bidder:"apn",strategy:{phase:{strategy:{one:"parallel",two:"parallel",three:"dutch"}}}},aq:{loader:{expireTime:2592E6,staleTime:31536E6}},bid:{pricer:{gsp:{max_reduction_rate:1,soft_floor:100,sp_increment:10}},loaddfp:{gpt_url:"//www.googletagservices.com/tag/js/gpt.js",
gpt_ns:"googletag"},fetcher:{dfp:{ceiling:3E3,increments:500,postreadywait:0,pixel_key:"match|adx",context_key:"dfp"},ortb:{price_multiplier:1E3,xd_url:"about:blank",bidder_url:"about:blank",is_cors:!1},tag:{},json:{},criteo:{urlmaker:"urlmaker/criteo",cache_key_loading:"cx/criteo/load",cache_slot_prefix:"cx/criteo/slot",cache_key_loading_expire:36E5},yieldbot:{cache_key_loading:"cx/yieldbot/load",cache_key_loading_expire:36E5,cache_slot_prefix:"cx/yieldbot/slot"},mpm:{notify_url:"http://tags.mathtag.com/notify/js?exch=prm&type=won&",
urlmaker:"urlmaker/mpm"},xaxis:{postreadywait:200},oxm:{urlmaker:"urlmaker/oxm"},apn:{urlmaker:"urlmaker/apn"},pbm:{urlmaker:"urlmaker/pbm"},decorators:{cache:{expiration:6E4}}},invalid_expiration:0,expiration:3E4},controller:{nucleus:{gpt_restore:{timeout:1E3}},data_bus:{nucleus_notifier:{gpt_timeout:5E3}},tracker:{revoke:{event_name:"offer.revoked",prefix:"cx/pbcap",event_key:"placement_id"},delivery:{event_name:"offer.displayed",prefix:"cx/dlcap",event_key:"placement_id"}}},bidder:{max_duration:2E3,
partners:"aol apn apnh casale criteo dfp ixp ixp2 managed mpm omk oxm passback pbm pbm2 ppt ttd xaxis yax yieldbot".split(" "),bias:1,fetcher:"bid/fetcher/null",flag:!0,flag_must_bid:!1,flag_page_only:!1,priority:500,cacheable:!1,prefetch_only:!1,expiration:0,floor:0,phase:"two",secure:!1,invalid_limit:3,invalid_penalty_duration:3E5,invalid_penalty_skips:3,delivery_limit:Infinity,delivery_period:0,passback_limit:1,passback_period:1},eventlogger:{base_url:"//helix.beanstock.co",delay:500},impression:{context:{strategy:"phase",
biases:{},floor:0,maxduration:5E3,soft_floor:100,use_cache:!1,increment:1.1,jsonprops:{sizes:1,pub:1,cost:1,pageurl:1,slot:1,strategy:1,placement:1,shadow:1,synthetic:1,maxduration:1,hidden:1,id:1,sync:1}},passbacklistener:{msg_prefix:"bsm.pixelEvent"},adjuster:{enable:!1,cost:1E3,rate:10,interval:30},displayer:{criteo:{baseUrl:"//cas.criteo.com/delivery/ajs.php"},yieldbot:{lib_url:"//cdn.yldbt.com/js/yieldbot.intent.js"},xaxis:{slot_ids:{"728x90":"Top1","300x250":"x15","160x600":"x10","300x600":"x16"}}}},
offer:{share:0,pricer:"first"},user:{session_key:"cx/session",session_exp_sec:18E5,uid_cache_key:"cx/user/id",idmapper:{cache_key:"cx/user/map",partners:"casale criteo pubmatic pulsepoint the-trade-desk yahoo".split(" "),type:"user/sync/image",enabled:!1,expiration:864E5,url:"about:blank",encode_redirect:!0,uid:"",macro:"",validator:null,cleanup:null,secure:!0},iplookup:{enabled:!0,cache_key:"cx/ip_info",expireTime:7776E6,staleTime:2592E6,endpoint:"//geoh.beanstock.com/key=SAKD59X4RU899BSMBSMZ/ip=local?callback="},
sync:{iframe:{endpoint:"http://cdn.beanstock.com/pub/px/pixel.html",prefix:"cx.uid.sync"}},cache:{urlEntry:{default_expire:36E5,default_stale:3E5}}},utils:{mercury:{msg_data_regex:"bsm.pixelEvent:",data_attribute_keys:["impression-id","platform-name","placement_id","price"],id_attribute_name:"data-impression-id",cx_id_prefix:"cx/"}},zonemap:{enableCache:!1,expireTime:864E5,staleTime:36E5,cacheKey:"cx-zonemap"},flag:{prefix:"cx",cache_prefix:"cx/bids",price_cache_prefix:"cx/nucleus/prices",bid_cache_prefix:"cx/nucleus/bids",
enabled:!0,ceiling:5E3,increments:250,prices_expiration:6048E5,ready_event_name:"onNucleusReady",gpt_namespace:"googletag",bsm_namespace:"BSM",bsm_tag_namespace:"bsm_tag",bootstrap_script_name:"flagTag.js",loader:{tag_attributes:"pub pub-zone event-host zone-map-url soft-floor flag".split(" "),refresh_rate:6E4}},manifest:{slot:{expiry:864E5,cache_key:"cx/slot/manifest"},bidder:{expiry:864E5,cache_key:"cx/bidder/manifest"}},urlmaker:{type:null,apn:{member_id:1184,request_type:"fpt",secure_url:"https://secure.adnxs.com",
url:"http://ib.adnxs.com"},apnh:{request_type:"jpt",secure_url:"https://secure.adnxs.com",url:"http://ib.adnxs.com"},criteo:{baseurl:"//cas.criteo.com/delivery/ajs.php",cookie_name:"crtg_rta"},oxm:{url:"//ox-d.cbs.servedbyopenx.com/w/1.0",request_type:"jstag",jstag_key:"oxm_pubId"},pbm:{cookie_name:"crtg_rta",url:"http://bid.pubmatic.com/AdServer",request_type:"AdServerServlet",pub_key:"pbm_pubId",site_key:"pbm_siteId",context_key:"pbm"},mpm:{uripath:"bid/prm/js",hostname:"tags.mathtag.com",prm:0}}}});
BSM.define("config",["settings/config","settings/default"],function(f,d){var e=f.createRoot(d,window.bsm_tag&&window.bsm_tag.config||{});return window.BSM.config=e});
BSM.define("logger",["config"],function(f){function d(g){var a=window.console||{},b=a[g]||a.log;return b?Function.prototype.bind?Function.prototype.bind.call(b,a):function(){Function.prototype.apply.call(b,a,arguments)}:new Function}function e(b,a){this.logs=[];this.warns=[];this.errors=[];this.traces=[];this.prefix=b||"(unprefixed)";this.$output(a)}var b=["log","warn","trace","error"],h=(new Date).getTime(),c=function(){for(var g={},a=0;a<b.length;++a)g[b[a]]=d(b[a]);return g}();e.prototype={logs:null,
warns:null,errors:null,traces:null,prefix:"",$debug:!1,$output:function(b){null!=b&&(this.$debug=b);return this.$debug||f.get("debug")},track:function(b,a){if("log"===b)this.logs.push(a);else if("warn"===b)this.warns.push(a);else if("error"===b)this.errors.push(a);else if("trace"===b)this.traces.push(a);else throw"Unknown log action";},getPrefix:function(){var b=new Date-h,b=Math.floor(b/100)/10;return"+"+("+"+b+"s")+" "+this.prefix+": "},log:function(b){var a=Array.prototype.slice.call(arguments,
0);a[0]=[this.getPrefix(),a[0]].join("");this.track("log",a);this.$output()&&c.log.apply(null,a)},warn:function(b){var a=Array.prototype.slice.call(arguments,0);a[0]=[this.getPrefix(),a[0]].join("");this.track("warn",a);this.$output()&&c.warn.apply(null,arguments)},error:function(b){var a=Array.prototype.slice.call(arguments,0);a[0]=[this.getPrefix(),a[0]].join("");this.track("error",a);this.$output()&&c.error.apply(null,a)},trace:function(){var b=Array.prototype.slice.call(arguments,0);this.track("trace",
[Error().stack]);this.$output()&&c.trace.apply(null,b)}};return e});
BSM.define("logger/messages",[],function(){return{RECEIVED_POST_MESSAGE:"received postMessage: %o",ONMESSAGE_FAILED:"onmessage failed: %o",SOLICITING_BID:'soliciting bid from "%s"',PHASE_ABORTED:"#abort(): phase aborted",PHASE_STARTING:"#start(): starting phase strategy, bidders = %o",PHASE_STARTED_NO_BIDDERS:"#startPhase(): %s/%s no bidders, ending phase",PHASE_STARRTED:"#startPhase(): #%s/%s, starting",PHASE_CLEARED:"#clearPhase() -- clearing phase %s/%s.",SENDING_BID_REQUEST:'#send() -- soliciting bid from "%s"',
BID_COLLECTED:"#collect() -- $%s offer: %o",AUCTION_OPEN:"#open(): resource %o",TIMEOUT_NO_WINNER:"timeout! no winner, waiting %s",AUCTION_TIMEOUT:"exceeded maximum duration, declaring winner",OFFER_COLLECTED:"#collectOffer(): [%s] must: %s valid: %s",OFFER_CHECKED:'#check(): check claimed status of offer["%s"]',AUCTION_CLEARED:'#clearAuction() selected winning bid from platform "%s", cleared: $%s',AUCTION_CLOSED:"#close() sending notification, showing winner",AUCTION_REVOKED:"#onRevoked(): winning offer revoked",
AUCTION_IS_SYNC:".startAuction(): Sync auction for apn? %o",OFFER_CACHED:"caching new offer #%s (+%s stale): %o",BUILDING_GPT_SLOT:'building slot for "%s"',DFP_BIDDER_ABORT:"#abort(): received for request`%s`",DFP_ELEMENT_REMOVED:"removing element for slot %s",DFP_ON_RENDER_END:'render ended for slot "%s"',DFP_HIDDEN_SLOT:'slot "%s" got empty response from dfp',DFP_ON_REVOKE:'slot "%s" revoked',DFP_ON_FRAME_READY:'Frame for slot "%s" is ready. Resolving in %dms',DFP_POST_READY_WAIT_COMPLETE:'post ready wait for slot "%s" complete, resolving',
DFP_OFFER_REJECT:'rejecting offer from slot "%s"',DFP_REJECT_MESSAGE_RECEIVED:'rejection message from "%s"',XAXIS_OFFER_RESOLVED:"#sendValidOffer(), was fulfilled=%o",XAXIS_OFFER_REJECTED:"#sendRejectOffer(), was fulfilled=%o",BID_TIMEOUT:"timed out after %s ms, abort()ing",FLUSH_RUN_QUEUE:"flushing existing run queue",MANIFEST_ENTRY_ADDED:"#add(): %s -> %o (expire=%o)",ABSTRACT_METHOD_ERROR:"method %s#%s() was not overridden",ERROR_RUNNING_COMMAND:"error running command: ",REVOKE_ERROR_GETTING_ID:"can not get impression id for revoked event: %o",
BIDDER_KEYGEN_ARGUMENT_ERROR:"cannnot generate manifest key - received null platform / impression",BIDDER_KEYGEN_IMPRESSION_ERROR:"Can not generate manifest key - missing a required field: "}});
(function(f){BSM.define("when/when",["require"],function(d){function e(a,l,k,b){return(a instanceof h?a:c(a)).then(l,k,b)}function b(a){return new h(a,I.PromiseStatus&&I.PromiseStatus())}function h(b,c){function m(l){if(f){var k=f;f=D;e=a(h,l);w(function(){c&&q(e,c);g(k,e)})}}function d(a){m(new l(a))}function p(a){if(f){var l=f;w(function(){g(l,new k(a))})}}var h,e,f=[];h=this;this._status=c;this.inspect=function(){return e?e.inspect():{state:"pending"}};this._when=function(a,l,k,b,c){function g(m){m._when(a,
l,k,b,c)}f?f.push(g):w(function(){g(e)})};try{b(m,d,p)}catch(t){d(t)}}function c(a){return b(function(l){l(a)})}function g(a,l){for(var k=0;k<a.length;k++)a[k](l)}function a(a,k){if(k===a)return new l(new TypeError);if(k instanceof h)return k;try{var b=k===Object(k)&&k.then;return"function"===typeof b?m(b,k):new p(k)}catch(c){return new l(c)}}function m(a,l){return b(function(k,b){w(function(){try{H(a,l,k,b)}catch(c){b(c)}})})}function p(a){this.value=a}function l(a){this.value=a}function k(a){this.value=
a}function q(a,l){a.then(function(){l.fulfilled()},function(a){l.rejected(a)})}function t(a){return a&&"function"===typeof a.then}function f(a,l,k,c,g){return e(a,function(a){return b(function(k,b,c){function g(a){t(a)}function m(a){f(a)}var d,q,p,h,f,t,n,r;n=a.length>>>0;d=Math.max(0,Math.min(l,n));p=[];q=n-d+1;h=[];if(d)for(t=function(a){h.push(a);--q||(f=t=B,b(h))},f=function(a){p.push(a);--d||(f=t=B,k(p))},r=0;r<n;++r)r in a&&e(a[r],m,g,c);else k(p)}).then(k,c,g)})}function r(a,l,k,b){return u(a,
B).then(l,k,b)}function u(a,l,k){return e(a,function(a){return new h(function(b,c,g){function m(a,q){e(a,l,k).then(function(a){d[q]=a;--p||b(d)},c,g)}var d,q,p,h;p=q=a.length>>>0;d=[];if(p)for(h=0;h<q;h++)h in a?m(a[h],h):--p;else b(d)})})}function v(a){return{state:"fulfilled",value:a}}function y(a){return{state:"rejected",reason:a}}function w(a){1===J.push(a)&&E(A)}function A(){g(J);J=[]}function B(a){return a}function F(a){"function"===typeof I.reportUnhandled?I.reportUnhandled():w(function(){throw a;
});throw a;}e.promise=b;e.resolve=c;e.reject=function(a){return e(a,function(a){return new l(a)})};e.defer=function(){var a,k,g;a={promise:D,resolve:D,reject:D,notify:D,resolver:{resolve:D,reject:D,notify:D}};a.promise=k=b(function(b,d,m){a.resolve=a.resolver.resolve=function(a){if(g)return c(a);g=!0;b(a);return k};a.reject=a.resolver.reject=function(a){if(g)return c(new l(a));g=!0;d(a);return k};a.notify=a.resolver.notify=function(a){m(a);return a}});return a};e.join=function(){return u(arguments,
B)};e.all=r;e.map=function(a,l){return u(a,l)};e.reduce=function(a,l){var k=H(G,arguments,1);return e(a,function(a){var b;b=a.length;k[0]=function(a,k,c){return e(a,function(a){return e(k,function(k){return l(a,k,c,b)})})};return C.apply(a,k)})};e.settle=function(a){return u(a,v,y)};e.any=function(a,l,k,b){return f(a,1,function(a){return l?l(a[0]):a[0]},k,b)};e.some=f;e.isPromise=t;e.isPromiseLike=t;x=h.prototype;x.then=function(a,l,k){var b=this;return new h(function(c,g,d){b._when(c,d,a,l,k)},this._status&&
this._status.observed())};x["catch"]=x.otherwise=function(a){return this.then(D,a)};x["finally"]=x.ensure=function(a){function l(){return c(a())}return"function"===typeof a?this.then(l,l).yield(this):this};x.done=function(a,l){this.then(a,l)["catch"](F)};x.yield=function(a){return this.then(function(){return a})};x.tap=function(a){return this.then(a).yield(this)};x.spread=function(a){return this.then(function(l){return r(l,function(l){return a.apply(D,l)})})};x.always=function(a,l){return this.then(a,
a,l)};z=Object.create||function(a){function l(){}l.prototype=a;return new l};p.prototype=z(x);p.prototype.inspect=function(){return v(this.value)};p.prototype._when=function(a,k,b){try{a("function"===typeof b?b(this.value):this.value)}catch(c){a(new l(c))}};l.prototype=z(x);l.prototype.inspect=function(){return y(this.value)};l.prototype._when=function(a,k,b,c){try{a("function"===typeof c?c(this.value):this)}catch(g){a(new l(g))}};k.prototype=z(x);k.prototype._when=function(a,l,k,b,c){try{l("function"===
typeof c?c(this.value):this.value)}catch(g){l(g)}};var x,z,C,G,H,E,J,I,K,D;J=[];I="undefined"!==typeof console?console:e;if("object"===typeof process&&process.nextTick)E=process.nextTick;else if(x="function"===typeof MutationObserver&&MutationObserver||"function"===typeof WebKitMutationObserver&&WebKitMutationObserver)E=function(a,l,k){var b=a.createElement("div");(new l(k)).observe(b,{attributes:!0});return function(){b.setAttribute("x","x")}}(document,x,A);else try{E=d("vertx").runOnLoop||d("vertx").runOnContext}catch(M){K=
setTimeout,E=function(a){K(a,0)}}d=Function.prototype;x=d.call;H=d.bind?x.bind(x):function(a,l){return a.apply(l,G.call(arguments,2))};d=[];G=d.slice;C=d.reduce||function(a){var l,k,b,c;c=0;l=Object(this);b=l.length>>>0;k=arguments;if(1>=k.length)for(;;){if(c in l){k=l[c++];break}if(++c>=b)throw new TypeError;}else k=k[1];for(;c<b;++c)c in l&&(k=a(k,l[c],c,l));return k};return e})})("function"===typeof BSM.define&&BSM.define.amd?BSM.define:function(f){module.exports=f(require)});
BSM.define("when",["when/when"],function(f){return f});
BSM.define("lib/json2",[],function(){function f(a){return 10>a?"0"+a:a}function d(b){h.lastIndex=0;return h.test(b)?'"'+b.replace(h,function(l){var k=a[l];return"string"===typeof k?k:"\\u"+("0000"+l.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+b+'"'}function e(a,l){var k,b,h,f,r=c,u,v=l[a];v&&"object"===typeof v&&"function"===typeof v.toJSON&&(v=v.toJSON(a));"function"===typeof m&&(v=m.call(l,a,v));switch(typeof v){case "string":return d(v);case "number":return isFinite(v)?String(v):"null";case "boolean":case "null":return String(v);
case "object":if(!v)return"null";c+=g;u=[];if("[object Array]"===Object.prototype.toString.apply(v)){f=v.length;for(k=0;k<f;k+=1)u[k]=e(k,v)||"null";h=0===u.length?"[]":c?"[\n"+c+u.join(",\n"+c)+"\n"+r+"]":"["+u.join(",")+"]";c=r;return h}if(m&&"object"===typeof m)for(f=m.length,k=0;k<f;k+=1)"string"===typeof m[k]&&(b=m[k],(h=e(b,v))&&u.push(d(b)+(c?": ":":")+h));else for(b in v)Object.prototype.hasOwnProperty.call(v,b)&&(h=e(b,v))&&u.push(d(b)+(c?": ":":")+h);h=0===u.length?"{}":c?"{\n"+c+u.join(",\n"+
c)+"\n"+r+"}":"{"+u.join(",")+"}";c=r;return h}}"object"!==typeof JSON&&(JSON={});"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
h=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c,g,a={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},m;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,l,k){var b;g=c="";if("number"===typeof k)for(b=0;b<k;b+=1)g+=" ";else"string"===typeof k&&(g=k);if((m=l)&&"function"!==typeof l&&("object"!==typeof l||"number"!==typeof l.length))throw Error("JSON.stringify");return e("",{"":a})});
"function"!==typeof JSON.parse&&(JSON.parse=function(a,l){function k(a,b){var c,g,d=a[b];if(d&&"object"===typeof d)for(c in d)Object.prototype.hasOwnProperty.call(d,c)&&(g=k(d,c),void 0!==g?d[c]=g:delete d[c]);return l.call(a,b,d)}var c;a=String(a);b.lastIndex=0;b.test(a)&&(a=a.replace(b,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return c=eval("("+a+")"),"function"===typeof l?k({"":c},""):c;throw new SyntaxError("JSON.parse");});return window.JSON});BSM.define("window",[],function(){return window});BSM.define("utils/localstorage",["window"],function(f){var d;try{var e="localStorage"in f&&null!==f.localStorage&&f.localStorage,b;e.setItem("cx-lscheck","test");b=e.getItem("cx-lscheck");e.removeItem("cx-lscheck");d="test"===b?e:!1}catch(h){d=!1}return d});BSM.define("document",[],function(){return window.document});
BSM.define("utils/script",["when","document"],function(f,d){function e(b,h,c){var g=d.getElementsByTagName("script")[0],a=d.createElement("script");a.onload=a.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(this.onload=this.onreadystatechange=this.onerror=null,h.call(this))};a.onerror=function(a){this.onload=this.onreadystatechange=this.onerror=null;c("Network error")};a.src=b;g.parentNode.insertBefore(a,g)}return function(b){var d=f.defer();
e(b,function(){d.resolve(this)},function(b){d.reject(b)});return d.promise}});
BSM.define("utils/polyfill",[],function(){Array.prototype.indexOf=function(){function f(d,e){var b,h=Object(this),c=h.length>>>0;b=+e||0;if(null==this)throw new TypeError('"this" is null or not defined');if(0===c)return-1;Infinity===Math.abs(b)&&(b=0);if(b>=c)return-1;for(b=Math.max(0<=b?b:c-Math.abs(b),0);b<c;){if(b in h&&h[b]===d)return b;b++}return-1}return"function"==typeof Array.prototype.indexOf?Array.prototype.indexOf:f}();Array.prototype.forEach=function(){function f(d,e){if(null==this)throw new TypeError(" this is null or not defined");
if("function"!==typeof d)throw new TypeError(d+" is not a function");for(var b=Object(this),h=b.length>>>0,c=0,g=1<arguments.length?e:void 0;c<h;)c in b&&d.call(g,b[c],c,b),c++}return"function"==typeof Array.prototype.forEach?Array.prototype.forEach:f}();Array.prototype.map=function(){function f(d,e){if(null==this)throw new TypeError(" this is null or not defined");if("function"!==typeof d)throw new TypeError(d+" is not a function");for(var b=Object(this),h=b.length>>>0,c=1<arguments.length?e:void 0,
g=0,a=Array(h);g<h;)g in b&&(a[g]=d.call(c,b[g],g,b)),g++;return a}return"function"==typeof Array.prototype.map?Array.prototype.map:f}();Object.create=function(){function f(d){if(1<arguments.length)throw Error("Second argument not supported");if("object"!=typeof d)throw TypeError("Argument must be an object");var e=function(){};e.prototype=d;var b=new e;e.prototype=null;return b}return"function"==typeof Object.create?Object.create:f}()});
BSM.define("utils","when lib/json2 utils/localstorage utils/script utils/objects utils/polyfill".split(" "),function(f,d,e,b,h,c){function g(a,k,b){k=k||"=";b=b||"&";var c=[],d,m;for(m in a)if(d=a[m],a.hasOwnProperty(m)&&m){if("object"===typeof d)d=h.$isArray(d)?d.join(b+m+k):g(d,k,b);else if("boolean"===typeof d)d=d?"y":"n";else if(null==d||void 0===d)d="";"string"!==typeof d&&"number"!==typeof d||c.push(m+k+d)}return c.join(b)}function a(a){return!(a.readyState&&"complete"!==a.readyState&&"loaded"!==
a.readyState)}function m(a,k){var b=this,c=Array.prototype.slice.call(arguments,0);return function(){var k=c.slice(1);k.push.apply(k,Array.prototype.slice.call(arguments,0));return a.apply(b,k)}}function p(a,k){for(var b in k)k.hasOwnProperty(b)&&(a[b]=k[b]);return a}return{$script:b,$localStorage:e,$isArray:h.$isArray,isObject:h.$isObject,$json:f.resolve(d),$toString:g,$bindTo:m,$bind:function(a,k,b){var c=Array.prototype.slice.call(arguments,1);return m.apply(a,c)},$whenReady:function(l){function k(c){c=
c.target||c.srcElement||this;if(!l.readyState||a(c))c.removeEventListener?c.removeEventListener("load",k,!0):c.detachEvent?c.detachEvent("onreadystatechange",k):c.onload=c.onreadystatechange=null,b.resolver.resolve(c)}var b=f.defer();if(l.readyState&&a(l))return b.resolve(l);l.addEventListener?l.addEventListener("load",k,!0):l.attachEvent?l.attachEvent("onreadystatechange",k):l.onload=l.onreadystatechange=k;return b.promise},$isReady:a,mixin:p,mergeDefaults:function(a,k,b){if(b){b={};for(var c in a)a.hasOwnProperty(c)&&
(b[c]=a[c]);a=b}for(var d in k)d in a||(a[d]=k[d]);return a},objectToQueryString:function(a){var k=[],b;for(b in a)a.hasOwnProperty(b)&&(k.length&&k.push("&"),k.push(b,"=",a[b]));return k.join("")},preprocessParams:function(a){var k={},b;for(b in a)if(a.hasOwnProperty(b)){if("string"!==typeof a[b])try{k[b]=d.stringify(a[b])}catch(c){}else k[b]=a[b];k[b]=encodeURIComponent(k[b])}return k},createArray:function(a,k){if("number"!==typeof a||0>a)a=0;for(var b=[],c=0;c<a;++c)b[c]=k;return b},roundToIncrement:function(a,
b,c){isNaN(c)&&(c=Infinity);isNaN(b)&&(b=1);a=Math.round(a/b)*b;return a<c?a:c},inDom:function(a,b){for(b=b||window.document;a&&a!==b;)a=a.parentNode;return a===b},isWindowHttps:function(){return"https:"===window.location.protocol},isUrl:function(a){return!(!a||!a.indexOf||0!==a.indexOf("http")&&0!==a.indexOf("https"))},dedupe:function(a){for(var b=a.length;b--;)a.indexOf(a[b])!==b&&a.splice(b,1)},inherit:function(a,b){function c(){}if("function"!==typeof a)throw Error("First argument must be function");
if(!a.prototype)throw Error("First argument must have a prototype");c.prototype=a.prototype;return p(new c,b)},all:function(a,b){if("function"!==typeof a||!h.$isArray(b))return!1;for(var c=!0,d=b.length-1;0<=d;d--)c=c&&a(b[d]);return c}}});
BSM.define("utils/custom_dom_event",["module","window","document"],function(f,d,e){function b(b,c){var d=e.createEvent("CustomEvent");d.initCustomEvent(b,c.bubbles,c.cancelable,c.detail);return d}b.prototype=window.Event&&window.Event.prototype||{};return"function"==typeof d.Event?d.CustomEvent:b});
BSM.define("utils/msgs",["module","logger","utils","document","utils/custom_dom_event"],function(f,d,e,b,h){function c(a,b){a=k(a);var l=m(a);l.addEventListener?l.addEventListener("cx_custom_event",b,!0):l.attachEvent&&l.attachEvent("oncx_custom_event",b);return l}function g(a,b){a=k(a);var l=m(a);l.removeEventListener?l.removeEventListener("cx_custom_event",b,!0):l.detachEvent&&l.detachEvent("oncx_custom_event",b);return l}function a(a,b){"object"==typeof a&&"event_name"in a&&(b=a,a=b.event_name);
a=k(a);var l=new h("cx_custom_event",{detail:{data:b,cx_event_name:a},bubbles:!0,cancelable:!0});m(a).dispatchEvent(l)}function m(a){return q(a)||p(a)}function p(a){a=a.split(".");var b=a.slice(0,a.length-1).join("."),b=q(b)||p(b);a.unshift(t);a=a.join(".");return b.appendChild(l(a))}function l(a){var l=b.createElement("div");l.id=a;l.style.display="none";l.style.visibility="hidden";return l}function k(a){u(a)&&(a=a.join("."));return a||""}function q(a){if(!a)return r;a=[t,a].join(".");var b;try{b=
r.querySelectorAll('[id="'+a+'"]')}catch(l){return null}return b[0]}var t,n,r,u=e.$isArray;(function(){var a=b.getElementsByTagName("script")[0];new d(f.id);t=["cx",f.id].join("_").replace("/","_");r=n=b.createElement("div");r=p("root");var l=window.navigator.userAgent;!l.match(/phantom/i)&&!l.match(/safari/i)||l.match(/chrome/i)||a.parentNode.insertBefore(n,a);t=[t,"root"].join(".")})();return{listen:c,on:c,off:g,unlisten:g,fire:a,async:a}});
BSM.define("microdollar",[],function(){function f(d){if(d instanceof f)return d.clone();this._quantity=0;this.currency="usd";this.quantity(d)}f.prototype={_quantity:0,constructor:f,currency:"usd",quantity:function(d){if(null===d||void 0===d)return this._quantity;d=d instanceof f?d.quantity():parseInt(d,10);if(isNaN(d))throw new TypeError("amount must be an integer");return this._quantity=d},getCPM:function(){return Math.ceil(this.quantity()/10)/100},gt:function(d){return this.quantity()>d.quantity()},
gte:function(d){return this.quantity()>=d.quantity()},multiplyBy:function(d){d=parseFloat(d);if(!d||1===d)return this;this.quantity(Math.round(this._quantity*d));return this},clone:function(){var d=new this.constructor(this._quantity);d.currency=this.currency;return d},toJSON:function(){return this._quantity}};return f});
BSM.define("bidder/registry",[],function(){function f(){this.bidders=[];this.name_map={}}f.prototype={bidders:null,length:0,name_map:null,add:function(d){this.bidders.push(d);this.length=this.bidders.length;this._addToNameMap(d,this.length-1)},_addToNameMap:function(d,e){var b=d.get("platform");b&&"string"===typeof b&&(this.name_map[b.toLowerCase()]=e)},getByName:function(d){d=this.name_map[d.toLowerCase()];return this.bidders[d]}};return f});
BSM.define("impression/positionmap",[],function(){return{above:1,1:"above",below:3,3:"below",unknown:0,0:"unknown"}});
BSM.define("impression/context","config module bidder/registry microdollar ./positionmap utils".split(" "),function(f,d,e,b,h,c){function g(a){var b;this.sizes=["1x1"];this.biases=m.get("biases");this.increment=m.get("increment");this.soft_floor=m.get("soft_floor");this.maxduration=m.get("maxduration");for(b in a)this[b]=a[b];"string"===typeof this.container&&(this.container=document.getElementById(this.container));this.id=this.container&&this.container.id||this.id||"cx/"+Math.floor(1E12*Math.random()).toString(36);
a=a.kv;b={imp:this.id};if(a)for(var d in a)b[d]=a[d];this.kv=b;this.size=this.sizes[0]||"";this.site=(this.pub_zone||"").split("/")[0];this.pos="unknown"===this.position?"":this.position;this.positionIndex=this.pos in h?h[this.pos]:0;this.bidderRegistry=new e;this.placement||(this.placement=this.pub+":"+this.pub_zone+"#"+this.slot);c.isUrl(this.pageurl)||(this.pageurl=p)}function a(){if(window==window.top)return location.href;var a,b;try{a=top.location.href}catch(c){}if(a)return a;for(b=window.parent;b!=
window.parent;){try{a=b.location.href}catch(d){}b=b.parent}return a?a:(a=document.referrer)&&0===a.indexOf("http")?a:""}var m=f.namespace(d.id);d=m.get("strategy");var p=function(){var b=a(),k=b.indexOf("?");0<k&&(b=b.substr(0,k));return encodeURIComponent(b)}();g.prototype={slotId:"",flag:!1,firstLook:!1,id:null,cacheKey:"",use_cache:!1,minimum_offer_cache_size:void 0,sizes:null,size:"",pos:"unknown",position:"unknown",slot:"",strategy:d,pageurl:p,container:null,bidderRegistry:null,dfp:null,ixp:null,
apn:null,apnplacement:null,zone_map_url:"",shadow:!1,debug:!1,kv:{},pub_zone:"",maxduration:0,network_tags:null,increment:0,oxm:0,rubrtb:null,adcomkt:null,tribfus:null,burst:null,floor:0,fl_soft_floor:1E3,soft_floor:100,biases:null,bidders:[],bidders_map:{},criteo_floor:0,nid:"",reserve:0,bcat:null,badv:null,battr:null,kw:null,aq_url:"",hidden:!1,sync:!1,event_host:"",pub:"",price_bar:NaN,rurl:"",placement:"",session:{},geo:"",getSlotId:function(){return this.slotId?this.slotId:this.slotId=this.placement?
this.placement.replace(/[:#]/g,"/"):["cx",this.pub_zone,Math.floor(1E6*Math.random())].join("/")},toJSON:function(){var a={},b=m.get("jsonprops"),c;for(c in this)c in b&&(a[c]=this[c]);a.id=this.id;return a},getSlotKey:function(){this.cacheKey||(this.cacheKey=this.pub_zone+"@"+this.size+"#"+this.position);return this.cacheKey},isFirstLook:function(){return!(!this.firstLook&&!this.flag)},useCache:function(){return this.isFirstLook()?!0:this.hasOwnProperty("use_cache")?this.use_cache:m.get("use_cache")},
minimumOfferCacheSize:function(){var a=this.minimum_offer_cache_size;return"number"===typeof a?a:this.isFirstLook()?2:1},getSection:function(){return(this.pub_zone||"").split("/")[1]||"unknown"},resetContainer:function(){var a=this.clearContainer();if(a){if(a){var b=(this.sizes[0]||"1x1").split("x"),c=b[0];a.style.height=b[1]+"px";a.style.width=c+"px"}a.id=this.id="cx/"+Math.floor(1E12*Math.random()).toString(36)}},clearContainer:function(){var a=this.container;if(a)for(;a&&a.childNodes.length;)a.removeChild(a.childNodes[0]);
return a},removeContainer:function(){var a=this.container;a&&a.parentNode.removeChild(a)},getSoftFloor:function(){var a=this.isFirstLook(),k=this.getFloor().quantity(),c=(a?this.fl_soft_floor:this.soft_floor)||0,d=this.price_bar||0;return a?new b(Math.max(k,c,d)):new b(Math.max(k,c))},getFloor:function(){var a=this.floor;return 0<a?new b(a):new b(f.get("impression/context/floor"))}};return g});
BSM.define("impression",["microdollar","impression/context"],function(f,d){function e(b){b=b instanceof d?b:new d(b);var h=b.getFloor().quantity();this.context=b;this.reserve=new f(h)}e.prototype={context:null,reserve:null,toString:function(){return["Impression: ",this.context.placement,"@",this.context.sizes.join(",")].join("")},toJSON:function(){return this.context.toJSON()}};return e});
BSM.define("impression/adjusterconfig",["config"],function(f){function d(d){this.base=b.namespace(d.pub)}function e(d){return function(){return this.base.defined(d)?this.base.get(d):b.get(d)}}var b=f.namespace("impression/adjuster");d.prototype={base:null,enable:e("enable"),cost:e("cost"),rate:e("rate"),interval:e("interval")};return d});
BSM.define("impression/adjuster",["utils","./adjusterconfig"],function(f,d){function e(b){this.config=new d(b.resource.context);this.auction=b;b.defer.promise.then(this.$bindTo(this.whenCleared))}e.prototype={auction:null,config:null,$bindTo:f.$bindTo,whenCleared:function(){this.adjustmentNeeded()&&this.scheduleAdjustment();return this.auction},adjustmentNeeded:function(){var b=this.config,d=Math.floor(100*Math.random()),c=this.auction.clearedPrice;return b.enable()&&b.rate()>d&&b.cost()<=c.quantity()},
scheduleAdjustment:function(){setTimeout(this.$bindTo(this.adjust),1E3*this.config.interval())},adjust:function(){var b=this.auction,d=b.resource,c=d.context,b=new b.constructor(d);~c.placement.search("#")||(c.placement+="#");c.placement=c.placement.replace(/#([a-z]+)?$/,"#adj");c.flag=!1;d.reserve.quantity(0);c.resetContainer();b.open()}};return e});
BSM.define("utils/sessionstorage",["window"],function(f){var d;try{var e="sessionStorage"in f&&null!==f.sessionStorage&&f.sessionStorage,b;e.setItem("cx-lscheck","test");b=e.getItem("cx-lscheck");e.removeItem("cx-lscheck");d="test"===b?e:!1}catch(h){d=!1}return d});
BSM.define("user/cache/urlEntry",["require","utils/script","when","config","module"],function(f){function d(a){function b(){var d;if("string"===typeof l)d=window[l];else if("function"===typeof l)try{d=l()}catch(g){return c.reject(g)}if(!d)return c.reject("Not found");k.value(d);k.expire(q||a.get("default_expire"));k.stale(f||a.get("default_stale"));k.release();return d}var g=a.uri,l=a.provider,k=a.entry,q=a.expire,f=a.stale;return a.jsonp?e(a):k.expire()&&k.lock()||k.stale()&&k.lock()?h(g).then(b):
k.valueAnd().then(function(b){return k.stale()?d(a):b})}function e(a){var d=c.defer(),e=a.uri,l=a.provider,k=a.entry,q=a.expire,f=a.stale,n=a.jsonp;(a=a.jsonpCallback)||(a="bsm_jsonp_"+Math.floor(1E6*Math.random()));e="string"===typeof n?b(e,n,a):e+a;window[a]=function(a){if("function"===typeof l)try{a=l(a)}catch(b){d.reject(b)}a||d.reject("Not found");k.value(a);k.expire(q||g.get("default_expire"));k.stale(f||g.get("default_stale"));k.release();d.resolve(a)};return k.expire()&&k.lock()||k.stale()&&
k.lockPartial()?(h(e).otherwise(function(a){d.reject(a)}),d.promise):k.valueAnd().then(function(a){return k.expire()||!a?c.reject("Not found"):a})}function b(a,b,c){-1===a.indexOf("?")&&(a+="?");a.charAt(a.length-1);return b+"="+c}var h=f("utils/script"),c=f("when"),g=f("config").namespace(f("module").id);return d});
BSM.define("user/cache/entry",["require","when","user/cache/urlEntry"],function(f){function d(b,a,c,d){this.key=b;this.lockOwner=!1;this.reader=function(){var c=a(b);c&&c.cacheEntry||(c={cacheEntry:!0,value:null!=c?c:null});c.expire=(new Date(c.expire||Number(new Date)-864E5)).getTime();c.stale=(new Date(c.stale||Number(new Date)-864E5)).getTime();c.lock&&(c.lock.expire=new Date(c.lock.expire||0));return c};this.writer=function(a){c(b,a)};this.remover=function(){d(b)};this.raw=this.reader()}function e(b){return!(b&&
"DANGERZONE"===b.state&&b.expire>Number(new Date))}function b(b){return b&&b.expire>Number(new Date)&&("DANGERZONE"===b.state||"DUMPTRUCK"===b.state)}var h=f("when"),c=f("user/cache/urlEntry");d.prototype.value=function(c){var a=this.reader();if("undefined"===typeof c){if(!e(a.lock)&&!this.lockOwner)throw Error("Entry is locked");this.raw=a;return this.checkExpiration()}if(b(a.lock)&&!this.lockOwner)throw Error("Entry is locked");this.raw.value=c;return this};d.prototype.valueAnd=function(c){var a=
h.defer(),d=this,p=d.reader(),l;"undefined"!==typeof c?b(p.lock)?a.reject("Entry is locked"):(d.raw.value=c,a.resolve(c)):e(p.lock)?(d.raw=p,a.resolve(d.checkExpiration())):l=setInterval(function(){p=d.reader();if(e(p.lock)){d.raw=p;var b=d.checkExpiration();a.resolve(b);clearInterval(l)}},50);return a.promise};d.prototype.expire=function(b){b=Number(b);return isNaN(b)?!(this.raw.expire>Number(new Date)):(this.raw.expire=(new Date((new Date).getTime()+b)).getTime(),this)};d.prototype.stale=function(b){b=
Number(b);if(isNaN(b))return!(this.raw.stale>Number(new Date));this.raw.stale=(new Date((new Date).getTime()+b)).getTime();return this};d.prototype.lock=function(){return this.setLockTo("DANGERZONE")};d.prototype.lockPartial=function(){return this.setLockTo("DUMPTRUCK")};d.prototype.setLockTo=function(c){function a(){var a=e.reader();delete a.lock;e.writer(a)}var d=this.reader(),e=this;if(b(d.lock))return!1;this.raw.lock=d.lock={state:c,expire:new Date(Number(new Date)+5E3)};window.addEventListener?
window.addEventListener("unload",a):window.attachEvent?window.attachEvent("onbeforeunload",a):window.onbeforeunload=a;this.lockOwner=!0;this.writer(d);return!0};d.prototype.lockAnd=function(){var c=this.reader();if(b(c.lock))return h.reject(this.value());this.raw=c;this.lock();return h.resolve(c.value)};d.prototype.save=function(){this.writer(this.raw);return this};d.prototype.release=function(){delete this.raw.lock;this.lockOwner=!1;return this.save()};d.prototype.fetch=function(b){b.entry=this;
b.uri||(b.uri=this.key);return c(b)};d.prototype.remove=function(){this.remover();return null};d.prototype.checkExpiration=function(){return this.expire()?(this.raw={},this.remove()):this.raw.value};return d});
BSM.define("user/cache",["require","utils/localstorage","./cache/entry"],function(f){function d(b){b=h?h[b]:null;try{b=JSON.parse(b)}catch(a){b=null}return b}function e(b,a){var c;try{c=JSON.stringify(a)}catch(d){return}h&&(h[b]=c)}function b(b){h&&h.removeItem(b)}var h=f("utils/localstorage"),c=f("./cache/entry");return function(g){return new c(g||"",d,e,b)}});
BSM.define("user/session",["config","utils/sessionstorage","user/cache","utils"],function(f,d,e,b){function h(){var a={},b;d?(b=d.getItem("pv"))&&(a.pv=b):a.pv=-1;return a}function c(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}f=f.namespace("user");var g=f.get("session_key")||"cx/session",a=f.get("session_exp_sec")||18E5;return{getValue:function(){var a=e(g),a=a.expire()?"":a.value();a||(a={},a.id=""+(new Date).getTime()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c(),a.pv=0,a.sc=
0,a.ac=0,this.save(a));return a},save:function(b){var c=e(g);c.value(b);c.expire(a);c.save()},incPageViewCount:function(){var a=h().pv;void 0===a&&(a=this.inc("pv"),d&&d.setItem("pv",a.pv));return a},incStartCount:function(a){this.incPageViewCount();var b=this.inc("sc");this.saveToCtx(a);return b},incAuctionCount:function(a){var b=this.inc("ac");this.saveToCtx(a);return b},saveToCtx:function(a){if(a){var c=this.getValue(),d=h();a.session=b.mixin(c,d)}},inc:function(a){var b=this.getValue(),c=b[a],
c=Number(c),c=isNaN(c)?1:c+1;b[a]=c;this.save(b);return b}}});
BSM.define("offer/displayer",[],function(){function f(){}f.prototype={promise:null,type:"super",iframe:null,display:function(d,e,b,h){var c=this,g=e.container;e=this._getOptions(e,g.id,b,h);this.promise||(this.promise=this._getFrame(d,g,e),this.promise.then(function(a){c.iframe=a}));return this.promise},remove:function(d){var e=d.container,b=this;this.iframe?e.removeChild(this.iframe):this.promise.then(function(){e.removeChild(b.iframe)})},_getOptions:function(d,e,b,h){d=d.size.split("x");var c=["cx_frame",
d[0],d[1],e].join("/");return{width:d[0],height:d[1],name:c,id:c,"data-impression-id":e,"data-placement_id":b,"data-price":h}},_getFrame:function(d,e,b){throw"Implement me";}};return f});BSM.define("offer/displayer/identity",["utils","when","offer/displayer"],function(f,d,e){function b(b){e.apply(this,arguments);this.promise=b||d.resolve()}b.prototype=f.inherit(e,{type:"identity",_getFrame:function(){throw"never call me";}});return b});
BSM.define("auction/synchronous","logger config microdollar when module window document user/session offer/displayer/identity utils/msgs".split(" "),function(f,d,e,b,h,c,g,a,m,p){var l=0;return function(c){d.namespace(h.id);var e=c.resource,m=e.context,n=!1,r,u,v;p.async("auction.open",c);c.startTime=(new Date).getTime();a.incAuctionCount(m);r=d.get("auction/default_bidder");(new f("auctionSync/#"+ ++l)).log("sync loading "+r);if(v=function(a){return(a=c.getBidder(r))&&a.getOfferSync(a,e)}(r))u=v.context.adurl,
c.collect(v);try{c.check(),c.clear(),c.close()}catch(y){c.error(y)}BSM.onSyncClear=function(a){n||(n=!0,a="undefined"===typeof a||isNaN(a)?1:Math.floor(1E3*Number(a)),c.reconcile({price:a}))};u&&(m.removeContainer(),u='<div id="'+m.id+'">'+u+"</div>",g.write(u));return b.resolve(m)}});
BSM.define("user/sync/iframe",["config","document","logger","module","when"],function(f,d,e,b,h){function c(a){(new e("sync/iframe")).warn(a)}function g(b){if(b&&"string"===typeof b.data&&!(0>b.data.indexOf(a))){b=b.data.split(":");var d,e,g;if(1>=b.length)return c("no :");b=b[1];d=b.indexOf(a);if(0!==d)return c("no prefix");b=b.slice(d+a.length);d=b.indexOf("=");if(0>d)return c("no =");e=b.slice(0,d);return(g=l[e])?g.resolve(b.slice(d+1)):c("no defer ["+e+"]")}}f=f.namespace(b.id);var a=f.get("prefix"),
m=f.get("endpoint")+"?"+a,p=!1,l={};return function(a,b,c){b=a.get("macro");var e=a.get("url"),f=a.get("encode_redirect");a=a.get("sync_name")||c;if(c=l[a])return c.promise;b&&(p||(p=!0,window.addEventListener?window.addEventListener("message",g,!1):window.attachEvent&&window.attachEvent("onmessage",g)));c=d.createElement("iframe");var u=d.getElementsByTagName("script")[0],v=h.defer();if(b)var y=m+a+"="+b,e=e+(f?encodeURIComponent(y):y);c.src=e;c.style.display="none";u.parentNode.insertBefore(c,u);
l[a]=v;b||v.resolve(!0);return v.promise}});BSM.define("image",[],function(){return window.Image});BSM.define("user/sync/image",["image","when"],function(f,d){return function(e,b,h){function c(){g.resolver.resolve(!0)}e=e.get("url");var g=d.defer(),a=new f;if(!e||!b)return d.reject(Error("["+h+"] no url or guid"));a.onload=c;a.onerror=c;a.src=e+b;return g.promise}});
BSM.define("settings/idmappers/casale",["settings/config"],function(f){return f.explode({"user/idmapper":{enabled:!0,type:"user/sync/iframe",url:"//ip.casalemedia.com/usermatchredir?s=180346&cb=",defaultuid:"0",macro:"__UID__",validator:/^[a-zA-Z0-9.-]{24}&[0-9]{3}/,cleanup:function(d){d=String(d);var e=d.indexOf("&");0<=e&&(d=d.slice(0,e));return d=decodeURIComponent(d)},secure:!1}})});
BSM.define("settings/idmappers/criteo",["settings/config"],function(f){return f.explode({"user/idmapper":{enabled:!0,type:"user/sync/image",url:"//rtax.criteo.com/delivery/rta/rta.js?"}})});BSM.define("settings/idmappers/pubmatic",["settings/config"],function(f){return f.explode({"user/idmapper":{enabled:!0,type:"user/sync/iframe",url:"//ads.pubmatic.com/AdServer/js/syncuppixels.html"}})});
BSM.define("settings/idmappers/pulsepoint",["settings/config"],function(f){return f.explode({"user/idmapper":{enabled:!0,type:"user/sync/iframe",url:"//bh.contextweb.com/bh/sync/beanstock?rurl=",defaultuid:"0",encode_redirect:!1,macro:"%%VGUID%%"}})});BSM.define("settings/idmappers/the-trade-desk",["settings/config"],function(f){return f.explode({"user/idmapper":{enabled:!0,type:"user/sync/iframe",sync_name:"ttd",url:"//match.adsrvr.org/track/cmf/generic?ttd_pid=beanstock&ttd_tpi=",macro:"1"}})});
BSM.define("settings/idmappers/yahoo",["settings/config"],function(f){return f.explode({"user/idmapper":{enabled:!0,type:"user/sync/image",url:"//pr-bh.ybp.yahoo.com/sync/beanstock/"}})});
BSM.define("settings/idmappers","./idmappers/casale ./idmappers/criteo ./idmappers/pubmatic ./idmappers/pulsepoint ./idmappers/the-trade-desk ./idmappers/yahoo".split(" "),function(){for(var f="./idmappers/casale ./idmappers/criteo ./idmappers/pubmatic ./idmappers/pulsepoint ./idmappers/the-trade-desk ./idmappers/yahoo".split(" "),d={},e,b=0,h=f.length;b<h;b++)e=f[b].split("/").pop(),d[e]=arguments[b];return d});
BSM.define("user/idmapper","require module config utils logger when user/cache user/sync/iframe user/sync/image settings/idmappers".split(" "),function(f,d,e,b,h,c,g,a,m){function p(a){if(q[a])return q[a];var b=f("settings/idmappers/"+a),b=k.fork(b).namespace(d.id);return q[a]=b}function l(d,l){function k(){var e=q.get("type"),g="user/sync/iframe"===e?a:"user/sync/image"===e?m:null;if(!g)return g="Unknown syncer type ["+e+"]",(new h("user/idmapper#sync()")).warn(g),c.reject(Error(g));e=q;return!e.get("enabled")||
b.isWindowHttps()&&!e.get("secure")?c.reject(Error("Not okay to sync")):g(q,l,d)}function e(a){var b;a&&"boolean"!==typeof a?(b=q.get("validator"),b="string"===typeof b?(new RegExp(b)).test(a):!0):b=!!a;if(b){b=q.get("expiration");var c=g(w);c.value(a);c.expire(b);c.release()}}function f(a){var b=q.get("cleanup");return"function"===typeof b?b(a):a}var q=p(d),w=[q.get("cache_key"),d].join("/"),A=g(w);A.value()||(A.remove(),k().then(f).then(e))}var k=e.namespace(d.id),q={};return{getMapping:function(a){if(!a)return!0;
a=[p(a).get("cache_key"),a].join("/");return g(a).value()},checkAll:function(a){for(var b=k.get("partners"),c=0,d=b.length;c<d;c++)l(b[c],a)}}});
BSM.define("user/pageview",[],function(){function f(){var a=(new Date).getTime(),g={};window.BSM=window.BSM||{};window.BSM.pageview_id=a;(function(){function a(b){b=b||window.event;var c=b.data,d,e;try{e=JSON.parse(c),d=e.type}catch(h){return h}if(d&&g[d])g[d](e,b.source,b.origin)}window.addEventListener?window.addEventListener("message",a,!1):window.attachEvent&&window.attachEvent("onmessage",a)})();g.request=e;g.response=b;c({type:"request",at:d()})}function d(){return window.BSM.pageview_id}function e(a,
b,c){h(b,{type:"response",at:d()})}function b(a,b,c){a=a.at;d()>a&&(window.BSM.pageview_id=a)}function h(a,b,c){c=c||"*";var d;try{d=JSON.stringify(b)}catch(k){return}a&&a.postMessage&&a.postMessage(d,c)}function c(a){var b=window;for(g(b,a);b.parent!=b;)b=b.parent,h(b,a),g(b,a)}function g(a,b){try{for(var c=a.document.getElementsByTagName("iframe"),d=c.length-1;0<=d;d--)h(c[d].contentWindow,b)}catch(k){}}window.BSM&&window.BSM.pageview_id||(window.BSM=window.BSM||{},f());return d});
BSM.define("user",["config","user/idmapper","user/cache","user/session","user/pageview"],function(f,d,e,b,h){var c=f.namespace("user").get("uid_cache_key"),g=e(c).value();return{geoData:{},initialize:function(a){var b=this.getId();d.checkAll(b);a&&a.geo&&(this.geoData=a.geo)},getId:function(){g||(g=this.getSessionId(),e(c).value(g).expire(1E12).save());return g},getPartnerId:function(a){return d.getMapping(a)},getIp:function(){return this.geoData.ip||"192.168.1.1"},getCountry:function(){return this.geoData.country||
"US"},getRegion:function(){return this.geoData.region||"SF"},getSessionId:function(){return b.getValue().id},getPageViewId:function(){return h()}}});
BSM.define("eventlogger",["config","utils","utils/objects","user","document"],function(f,d,e,b,h){function c(a,b,c){a=d.preprocessParams(a);c=c||g;a=d.objectToQueryString(a);a=c+"/"+b+"?"+a;c=h.createElement("iframe");c.onload=c.onreadystatechange=function(){this.onload=this.onreadystatecahnge=null};c.src=a;c.id=["cx/event",b,Math.floor(1E12*Math.random())].join("/");c.style.display="none";b=h.getElementsByTagName("script");b=b[b.length-1];b.parentNode.insertBefore(c,b)}var g=f.namespace("eventlogger").get("base_url"),
a=f.get("version");return function(g,h,l,k){h.user={c:b.getCountry(),u:b.getId(),p:b.getIp(),pv_id:b.getPageViewId()};e.$isObject(h.session)&&(h.user=d.mixin(h.user,{s:h.session.id,s_pv:h.session.pv,s_sc:h.session.sc,s_ac:h.session.ac}),delete h.session);h.v=a;return c(h,g,l)}});
BSM.define("auction/databus/send/revoke",["eventlogger"],function(f){return function(d){var e=d.winner,b=d.resource,h=b.context;d={offer:e,impression:b,placement_id:e.offeredBy.get("placement_id"),price:~Math.max(0,d.clearedPrice.quantity()),session:h.session};f("revoked",d,h.event_host,h.id,!0)}});
BSM.define("auction/databus/send/cleared",["eventlogger","window"],function(f,d){return function(e){var b=e.resource,h=b.context,c=e.winner;e={offers:e.bidSelector.offers.slice(0),duration:e.duration,winner:c.offeredBy.platform,placement_id:c.offeredBy.get("placement_id"),impression:b,price:e.clearedPrice.quantity(),flag:h.flag?h.flag:!1,session:h.session};h.flag&&(e.nucleusVersion=d.BSM.nucleusVersion);f("cleared",e,h.event_host,h.id)}});
BSM.define("auction/databus/send/error",["eventlogger"],function(f){return function(d){var e=d.resource,b=e.context,h=d.bidSelector.offers.slice(0),c=d.error;f("error",{offers:h,duration:d.duration,impression:e,flag:b.flag?b.flag:!1,session:b.session,error:{name:c.name,message:c.message,stack:c.stack?c.stack.toString():""}},b.event_host,b.id,!0)}});BSM.define("auction/databus/send/filled",["eventlogger"],function(f){return function(d){var e=d.impression.context;f("filled",d,e.event_host,e.id)}});
BSM.define("auction/databus/send/passback",["eventlogger"],function(f){return function(d){var e=d.resource,b=e.context,h=b.getFloor();f("passback",{impression:e,floor:h,duration:d.duration,session:b.session},b.event_host,b.id)}});BSM.define("auction/databus/sendevent",["./send/revoke","./send/cleared","./send/error","./send/filled","./send/passback"],function(f,d,e,b,h){var c={cleared:d,revoked:f,error:e,filled:b,passback:h};return function(b,a){if(b in c)c[b](a)}});
BSM.define("bid/pricer",["module","config","microdollar"],function(f,d,e){function b(b,d,a){"number"===typeof b||b instanceof e||(b=h.get("soft_floor"));this.softFloor=new e(b);this.maxReductionRate=d||h.get("max_reduction_rate");this.increment=a||h.get("sp_increment")}var h=d.namespace("bid/pricer/gsp");b.prototype={get:function(b,d){var a=b.getPricingType();if("first"===a)return this.first(b);if("gsp"===a)return this.gsp(b,d);throw"Unknown price type";},first:function(b){return b.getPrice()},gsp:function(b,
d){var a=this.softFloor.clone(),h=this.increment,f=d?d.getPrice():new e(0),l=b.getPrice();a.gt(f)&&(f=a);a=f.quantity()+h;a<=l.quantity()&&f.quantity(a);f.gt(l)&&(f=l);return f}};return b});
BSM.define("bid/ranker",["bid/pricer","microdollar"],function(f,d){function e(b){if(!b.length)return[];for(var c=b[0],e=c.getPrice(),a=new d(0),m=null,f=!1,l,k,q,t,n,r=0,u=b.length;r<u;++r)l=b[r],k=l.getPrice(),t=(q=l.isValid())&&l.mustFill(),n=q&&(t||k.gt(e)),!f&&n&&(e.gt(a)&&(a=e,m=c),e=k,c=l,f=t),!n&&q&&k.gt(a)&&(a=k,m=l);return[m,c]}function b(b){this.pricer=b||new f;this._topOffers=[];this._allOffers=[]}b.prototype={_topOffers:null,_allOffers:null,pricer:null,rank:function(b){this._allOffers.push(b)},
_rank:function(){this._topOffers=e(this._allOffers).slice(0)},getFirst:function(){this._rank();return this._topOffers[this._topOffers.length-1]},getSecond:function(){this._rank();return this._topOffers[this._topOffers.length-2]},getSecondByOffer:function(b){var c=[],d=0,a=this._allOffers.length,m;if(b&&b.isValid()){for(;d<a;d++)m=this._allOffers[d],b.getPrice().gte(m.getPrice())&&c.push(m);b=e(c);return b[b.length-2]}}};return b});
BSM.define("utils/friendlyiframe",["when","utils"],function(f,d){function e(a,b){var c,e;for(e in b)b.hasOwnProperty(e)&&(c=b[e],"style"!==e?(a.setAttribute(e,c),a[e]=c):"style"===e&&"object"===typeof c&&a.style&&(a.style.cssText=d.$toString(c,":","; ")))}function b(a,b){h();var c=h();c&&11>=c?(c=a.contentWindow,c.content=b,c.location.replace("javascript:window.content")):(c=a.contentWindow.document,c.open("text/html","replace"),c.write(b),c.close())}function h(){return document.documentMode?parseInt(document.documentMode,
10):!1}var c=["<!doctype html><html><head></head><body>","<script>window.inDapIf=true;\x3c/script>","",null,"</body></html>"],g=h()?"javascript:":"javascript:\"<html><body style='background:transparent'></body></html>\"",a=0,m={frameBorder:0,vSpace:0,hSpace:0,marginHeight:0,marginWidth:0,scrolling:"no"};return function(h,l,k){++a;var q=document.createElement("iframe");k=d.mergeDefaults(k,m);var t=k.name||k.id||["bsm/fif",Math.floor(1E12*Math.random())].join("/"),n=c.slice(0),r=f.defer(),u=r.resolver,
v=!(0<=navigator.userAgent.indexOf("AppleWebKit")),y=k.onload;n[3]=h;delete k.onload;k.name=k.name||t;k.id=k.id||k.name;e(q,k);l.appendChild(q);q.onload=q.onreadystatechange=function(){try{if(!d.inDom(this,this.ownerDocument))return u.reject(Error("invalid dom state"))}catch(a){}if(d.$isReady(this)){if(v)return this.onload=this.onreadystatechange=null,u.resolve(this);v=!0}};q.src=g;try{b(q,n.join("")),"function"===typeof y&&y(q)}catch(w){return r.reject(w)}return r.promise}});
BSM.define("offer/displayer/friendly",["utils","offer/displayer","utils/friendlyiframe"],function(f,d,e){function b(){d.apply(this,arguments)}b.prototype=f.inherit(d,{type:"friendly",_getFrame:function(b,c,d){return e(b,c,d)}});return b});
BSM.define("lib/md5",[],function(){function f(a,c){var k=a[0],g=a[1],f=a[2],n=a[3],k=e(k,g,f,n,c[0],7,-680876936),n=e(n,k,g,f,c[1],12,-389564586),f=e(f,n,k,g,c[2],17,606105819),g=e(g,f,n,k,c[3],22,-1044525330),k=e(k,g,f,n,c[4],7,-176418897),n=e(n,k,g,f,c[5],12,1200080426),f=e(f,n,k,g,c[6],17,-1473231341),g=e(g,f,n,k,c[7],22,-45705983),k=e(k,g,f,n,c[8],7,1770035416),n=e(n,k,g,f,c[9],12,-1958414417),f=e(f,n,k,g,c[10],17,-42063),g=e(g,f,n,k,c[11],22,-1990404162),k=e(k,g,f,n,c[12],7,1804603682),n=e(n,
k,g,f,c[13],12,-40341101),f=e(f,n,k,g,c[14],17,-1502002290),g=e(g,f,n,k,c[15],22,1236535329),k=b(k,g,f,n,c[1],5,-165796510),n=b(n,k,g,f,c[6],9,-1069501632),f=b(f,n,k,g,c[11],14,643717713),g=b(g,f,n,k,c[0],20,-373897302),k=b(k,g,f,n,c[5],5,-701558691),n=b(n,k,g,f,c[10],9,38016083),f=b(f,n,k,g,c[15],14,-660478335),g=b(g,f,n,k,c[4],20,-405537848),k=b(k,g,f,n,c[9],5,568446438),n=b(n,k,g,f,c[14],9,-1019803690),f=b(f,n,k,g,c[3],14,-187363961),g=b(g,f,n,k,c[8],20,1163531501),k=b(k,g,f,n,c[13],5,-1444681467),
n=b(n,k,g,f,c[2],9,-51403784),f=b(f,n,k,g,c[7],14,1735328473),g=b(g,f,n,k,c[12],20,-1926607734),k=d(g^f^n,k,g,c[5],4,-378558),n=d(k^g^f,n,k,c[8],11,-2022574463),f=d(n^k^g,f,n,c[11],16,1839030562),g=d(f^n^k,g,f,c[14],23,-35309556),k=d(g^f^n,k,g,c[1],4,-1530992060),n=d(k^g^f,n,k,c[4],11,1272893353),f=d(n^k^g,f,n,c[7],16,-155497632),g=d(f^n^k,g,f,c[10],23,-1094730640),k=d(g^f^n,k,g,c[13],4,681279174),n=d(k^g^f,n,k,c[0],11,-358537222),f=d(n^k^g,f,n,c[3],16,-722521979),g=d(f^n^k,g,f,c[6],23,76029189),
k=d(g^f^n,k,g,c[9],4,-640364487),n=d(k^g^f,n,k,c[12],11,-421815835),f=d(n^k^g,f,n,c[15],16,530742520),g=d(f^n^k,g,f,c[2],23,-995338651),k=h(k,g,f,n,c[0],6,-198630844),n=h(n,k,g,f,c[7],10,1126891415),f=h(f,n,k,g,c[14],15,-1416354905),g=h(g,f,n,k,c[5],21,-57434055),k=h(k,g,f,n,c[12],6,1700485571),n=h(n,k,g,f,c[3],10,-1894986606),f=h(f,n,k,g,c[10],15,-1051523),g=h(g,f,n,k,c[1],21,-2054922799),k=h(k,g,f,n,c[8],6,1873313359),n=h(n,k,g,f,c[15],10,-30611744),f=h(f,n,k,g,c[6],15,-1560198380),g=h(g,f,n,k,
c[13],21,1309151649),k=h(k,g,f,n,c[4],6,-145523070),n=h(n,k,g,f,c[11],10,-1120210379),f=h(f,n,k,g,c[2],15,718787259),g=h(g,f,n,k,c[9],21,-343485551);a[0]=m(k,a[0]);a[1]=m(g,a[1]);a[2]=m(f,a[2]);a[3]=m(n,a[3])}function d(a,b,c,d,g,e){b=m(m(b,a),m(d,e));return m(b<<g|b>>>32-g,c)}function e(a,b,c,g,e,f,h){return d(b&c|~b&g,a,b,e,f,h)}function b(a,b,c,g,e,f,h){return d(b&g|c&~g,a,b,e,f,h)}function h(a,b,c,g,e,f,h){return d(c^(b|~g),a,b,e,f,h)}function c(b){var c=b,d=c.length;b=[1732584193,-271733879,
-1732584194,271733878];var g;for(g=64;g<=c.length;g+=64){for(var e=c.substring(g-64,g),h=[],m=void 0,m=0;64>m;m+=4)h[m>>2]=e.charCodeAt(m)+(e.charCodeAt(m+1)<<8)+(e.charCodeAt(m+2)<<16)+(e.charCodeAt(m+3)<<24);f(b,h)}c=c.substring(g-64);e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(g=0;g<c.length;g++)e[g>>2]|=c.charCodeAt(g)<<(g%4<<3);e[g>>2]|=128<<(g%4<<3);if(55<g)for(f(b,e),g=0;16>g;g++)e[g]=0;e[14]=8*d;f(b,e);for(c=0;c<b.length;c++){d=b;g=c;e=b[c];h="";for(m=0;4>m;m++)h+=a[e>>8*m+4&15]+a[e>>8*m&15];
d[g]=h}return b.join("")}function g(a,b){var c=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(c>>16)<<16|c&65535}var a="0123456789abcdef".split(""),m=function(a,b){return a+b&4294967295};"670b14728ad9902aecba32e22fa4f6bd"!=c("000000")&&(m=g);return c});
BSM.define("utils/ghostloader",["config","when"],function(f,d){function e(a){if(!(this instanceof e))return new e(a);a||(a=window);var d=b.call(c,a);if(0<=d)return g[d];c.push(a);g.push(this);if(a!==window)try{a.frameElement.style.display="none"}catch(f){}a.flog=function(a){return function(){console.warn("flog:",arguments);if("function"===typeof a)return a.apply(this,arguments)}}(a.flog);this.load=function(){return this.loadScript(a)}}function b(a){try{if(this.indexOf)return this.indexOf(a)}catch(b){}return-1}
var h=f.namespace("ghostwriter"),c=[],g=[];e.write=function(a,b){return(new e(window)).load().then(function(c){var g=['document.write("',a.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'")'].join(""),e=d.defer();c(b,{script:{text:g},done:e.resolver.resolve,insertType:"before"});return e.promise})};e.prototype={getScriptUrl:function(){return h.get("url")||"//cdn.beanstock.com/pub/gw.min.js"},loadScript:function(a){var b=d.defer();if("function"===typeof a.ghostwriter)return b.resolve(a.ghostwriter),b.promise;
var c=this.getScriptUrl(),g=a.document,e=g.createElement("script"),g=g.getElementsByTagName("head")[0];e.onload=e.onreadystatechange=function(){this.readyState&&"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onload=this.onreadystatechange=null,setTimeout(function(){b.resolve(a.ghostwriter)},100))};e.src=c;g.appendChild(e);return b.promise}};return e});
BSM.define("xdmanager",["when","utils/ghostloader"],function(f,d){function e(c){var g=c.data;if(0==g.indexOf("ghostloader")&&(g=g.split(":").slice(1),!(2>g.length))){var a=g.shift()||"";"#"===a[0]&&(a=a.slice(1));g=g.join(":");c.source.postMessage("ack.ghostloader:"+a,c.origin);c=b[a];if(!c||2!==c.length)throw Error("Security error: ghostloader event sent from invalid frame");c=c[1];c.style.display="none";d.write(g,c)}}var b={},h;return{add:function(c,d){var a=d.src,f=a.indexOf("#"),p;h||(h=!0,window.addEventListener?
window.addEventListener("message",e,!1):window.attachEvent&&window.attachEvent("onmessage",e));if(!a||0>f)return b[c]=[c.toLowerCase(),d],d;f=a.indexOf("//");p=a.indexOf("/",f);p=a.slice(f+2,p);a=(0===f?window.location.protocol:a.slice(0,f+2))+p;b[c]=[a.toLowerCase(),d];return d}}});
BSM.define("utils/remote_iframe",["document","utils","lib/md5","xdmanager","when"],function(f,d,e,b,h){function c(a,b){var c=f.createElement(a),d;for(d in b)b.hasOwnProperty(d)&&c.setAttribute(d,b[d]);return c}function g(a){return d.isWindowHttps()&&0===a.indexOf("http://")?a.substr(5):a}return function(a,f,p){a=g(a);var l=h.defer();p=d.mergeDefaults({frameBorder:0,vSpace:0,hSpace:0,marginHeight:0,marginWidth:0,scrolling:"no",allowtransparency:"true",style:"border:0px;margin:0px;padding:0px"},p);
var k=c("iframe",p);p=e(a);0!==a.indexOf("javascript:")&&(a=a+"#"+p);k.onload=k.onreadystatechange=function(){d.$isReady(this)&&l.resolver.resolve(k)};k.onerror=l.resolver.reject;f.appendChild(k);k.setAttribute("src",a);b.add(p,k);return l.promise}});BSM.define("offer/displayer/remote",["utils","offer/displayer","utils/remote_iframe"],function(f,d,e){function b(){d.apply(this,arguments)}b.prototype=f.inherit(d,{type:"remote",_getFrame:function(b,c,d){return e(b,c,d)}});return b});
BSM.define("offer/displayer/noop",["utils","when","offer/displayer"],function(f,d,e){function b(){e.apply(this,arguments)}b.prototype=f.inherit(e,{type:"noop",display:function(){return d.defer().promise},_getFrame:function(){return d.defer().promise},remove:function(){}});return b});
BSM.define("offer/displayer/create",["offer/displayer/friendly","offer/displayer/remote","offer/displayer/noop"],function(f,d,e){return function(b){return b&&"string"===typeof b?"http"===b.slice(0,4)||"//"===b.slice(0,2)?new d:new f:new e}});
BSM.define("model/event",["utils/msgs"],function(f){function d(d){if(d){var b=this.constructor.prototype,f;for(f in b)f in d&&(this[f]=d[f])}}d.extend=function(e,b){e.prototype=new d;e.prototype.constructor=e;e.prototype.$super=d;for(var f in b)b.hasOwnProperty(f)&&(e.prototype[f]=b[f]);return e};d.prototype.fire=function(){var d=this.event_name,b=this.fire;"event_key"in this&&this.event_key&&(d=[d,this.event_key]);delete this.fire;f.fire(d,this);this.fire=b;return this};return d});
BSM.define("model/event/offer/displayed",["../../event"],function(f){function d(d){this.$super.call(this,d)}f.extend(d,{event_name:"offer.displayed",event_key:"",display_type:null,impression:null,offer:null,placement_id:0,price:0});return d});
BSM.define("offer","module config microdollar when user/cache offer/displayer/create utils model/event/offer/displayed".split(" "),function(f,d,e,b,h,c,g,a){function m(a,b,d,g,f,m){if(!arguments.length)return this;this.offeredBy=g;this.timestamp=(new Date).getTime();this.context=b;this.askResource=d;this.resource=a;this.displayer=f||b.displayer||c(b.adurl);this.duration=g&&g.duration||0;this.setPrice(a,m);this.reserve=d&&d.reserve&&d.reserve.clone()||new e(0);if(this.key=b.key||"")this.cacheEntry=
h(this.key)}function p(a,b){if(!b)return b;var c=a.gross,c={"${AUCTION_AD_ID}":a.context.adid||"","${AUCTION_PRICE}":c.getCPM(),"${AUCTION_CURRENCY}":c.currency},d;for(d in c)c.hasOwnProperty(d)&&(b=b.replace(d,c[d]));return b}m.prototype={context:null,bindTo:g.$bindTo,key:"",cacheEntry:null,claimed:!1,displayer:null,metadata:null,timestamp:0,revoked:!1,gross:null,net:null,resource:null,askResource:null,offeredBy:null,duration:0,reserve:null,passback:!1,isValid:function(){return this.resource&&this.resource.gte(this.offeredBy.floor())&&
!this.revoked&&!this.claimed},mustFill:function(){return this.offeredBy.get("must_fill")},getCPM:function(){return this.net.getCPM()},toJSON:function(){var a={};a.by=this.getPlatform();a.bias=this.offeredBy.bias;a.val=this.net;a.res=this.reserve;a.valid=this.isValid();a.duration=this.duration;return a},setPrice:function(a,b){var c=parseFloat(this.offeredBy.get("share"))||0;b?this.calculateGross(a,c):this.calculateNet(a,c);this.resource=this.net;this.resource.multiplyBy(this.offeredBy.get("bias"));
return this},revoke:function(){this.net.quantity(-1E3);this.revoked=!0;this.displayer&&this.displayer.remove(this.askResource.context);this.context.rurl&&((new Image).src=this.context.rurl)},calculateNet:function(a,b){this.gross=a.clone();this.net=a.clone().multiplyBy(1-b)},calculateGross:function(a,b){this.net=a.clone();this.gross=a.clone().multiplyBy(1/(1-b))},getPlatform:function(){return this.offeredBy.platform||""},getGrossPrice:function(){return this.gross.clone()},getPrice:function(){return this.net.clone()},
hasBid:function(){return!!this.net},isClaimed:function(){var a;!(a=this.claimed)&&(a=!!this.cacheEntry)&&(a=this.cacheEntry,a=!(a.value()&&!a.expire()));return this.claimed=a},claim:function(){if(this.claimed)return!1;this.cacheEntry&&this.cacheEntry.remove();return this.claimed=!0},getPricingType:function(){return this.offeredBy.get("pricing_type")},canDisplay:function(){return!!this.context.adurl},display:function(){var a=this.offeredBy.get("placement_id"),c=this.getPrice().quantity(),d=p(this,
this.context.adurl),g=this.askResource.context;return this.displayer?this.displayer.display(d,g,a,c).then(this.bindTo(this.fireEvent)):b.reject("Offer has no displayer")},fireEvent:function(){(new a({event_key:this.askResource.context.getSlotKey(),display_type:this.displayer.type,offer:this,impression:this.askResource,placement_id:this.offeredBy.get("placement_id"),price:this.getPrice().quantity()})).fire()},getNotifyUrl:function(){return p(this,this.context.nurl)}};return m});
BSM.define("model/model",["utils"],function(f){function d(){}function e(b){var d=this,c=function(){return d.apply(this,arguments)};"object"===typeof b?c.prototype=f.inherit(this,b):b.prototype&&b.constructor&&(b.prototype=f.inherit(this,b.prototype),c=b);c.extend=e;return c}d.prototype={get:function(b){return this[b]},set:function(b,d){this[b]=d;return this[b]}};d.extend=e;return d});
BSM.define("utils/spec",[],function(){function f(b,c){this.one=b;this.other=c}function d(b,c){this.one=b;this.other=c}function e(b){this.one=b}var b={and:function(b){return new f(this,b)},or:function(b){return new d(this,b)},not:function(b){return new e(this,b)},isSatisfiedBy:function(b){throw"Implement me";}};f.prototype=Object.create(b);f.prototype.isSatisfiedBy=function(b){return this.one.isSatisfiedBy(b)&&this.other.isSatisfiedBy(b)};d.prototype=Object.create(b);d.prototype.isSatisfiedBy=function(b){return this.one.isSatisfiedBy(b)||
this.other.isSatisfiedBy(b)};e.prototype=Object.create(b);e.prototype.isSatisfiedBy=function(b){return!this.one.isSatisfiedBy(b)};return b});
BSM.define("bidder/specs",["utils/spec"],function(f){function d(b){this.limit=b}function e(b){this.count=b}function b(b){this.duration=b}function h(){}d.prototype=Object.create(f);d.prototype.isSatisfiedBy=function(b){b=b.invalid_count;return"number"===typeof b&&b>=this.limit};e.prototype=Object.create(f);e.prototype.isSatisfiedBy=function(b){b=b.invalid_skip_count;return"number"===typeof b&&b<this.count};b.prototype=Object.create(f);b.prototype.isSatisfiedBy=function(b){b=b.last_collected_at;var d=
(new Date(b)).getTime()+this.duration,a=(new Date).getTime();return!("number"===typeof b&&d>a)};h.prototype=Object.create(f);h.prototype.isSatisfiedBy=function(b){var d=!0;b.forEach(function(a){var b=a.shift();d=d&&b.isCapped.apply(b,a)});return d};return{OverInvalidCountSpec:d,InvalidSkipsRemainingSpec:e,InvalidPenaltyExpiredSpec:b,TrackersCapacityReachedSpec:h}});
BSM.define("utils/freqtracker",["user/cache"],function(f){function d(b){var d=f(b).value()||[];this.key=b;e(b,d)}function e(b,d){var c=f(b);c.value(d);c.expire(6048E5);c.stale(6048E5);c.save()}d.prototype={key:null,limit:null,period:null,getCount:function(b){if(!b)return 0;var d=f(this.key).value()||[],c=new Date,g=new Date(c.getTime());g.setDate(g.getDate()+1);g.setHours(0,0,0,0);do g.setHours(g.getHours()-b);while(c<g);g<c?g=new Date(c.setHours(c.getHours()-b)):g.setHours(g.getHours()-b);b=g;d=
d.slice(0);for(c=d.length;c--&&!((new Date(d[c])).getTime()<b.getTime()););return d.slice(c+1).length},tick:function(){var b=f(this.key).value()||[];b.push((new Date).getTime());e(this.key,b)},isCapped:function(b,d){return this.getCount(b)>=d}};return d});
BSM.define("bidder/manifest","module config utils utils/msgs user/cache bidder/specs utils/freqtracker".split(" "),function(f,d,e,b,h,c,g){function a(a,b,c){this.model=a;if(this.platform=b)this.setupTrackers(c),this.setupSpecs(a)}function m(a){return[l,"/",a.pub,":",a.site,"@",a.size,"#",a.position].join("")}var p=d.namespace("manifest/bidder"),l=p.get("cache_key");a.prototype={model:null,platform:null,inPenalty:null,penaltyExpired:null,deliveryTracker:null,passbackTracker:null,bindTo:e.$bindTo,shouldFetch:function(a){if(!this.inPenalty||
this.model.get("default"))return!0;a=m(a);a=this.getBySlot(a);var b=this.model.get("delivery_cap"),c=this.model.get("passback_cap"),b=[[this.deliveryTracker,b.period,b.interval],[this.passbackTracker,c.period,c.interval]];return this.inPenalty.not().isSatisfiedBy(a)&&this.canDeliver.isSatisfiedBy(b)},logOffer:function(a,b){var c=m(a),c=this.getBySlot(c),d=this.updateManifest(c,b);this.saveManifest(a,c);return d},getBySlot:function(a){return(a=h(a).value())&&"object"===typeof a&&a[this.platform]||
{}},setupSpecs:function(a){var b=a.get("invalid_cap");a=new c.OverInvalidCountSpec(b.limit);var d=new c.InvalidPenaltyExpiredSpec(b.period),g=new c.InvalidSkipsRemainingSpec(b.skips),b=new c.TrackersCapacityReachedSpec,e=d.or(g.not());a=a.and(d.not().or(g));this.penaltyExpired=e;this.inPenalty=a;this.canDeliver=b.not();return this},setupTrackers:function(a){this.deliveryTracker=this.getTracker("delivery");this.passbackTracker=this.getTracker("passback")},getTracker:function(a){a=d.namespace("controller/tracker/"+
a);a=[a.get("prefix"),this.model.get(a.get("event_key"))].join("/");return new g(a)},updateManifest:function(a,b){function c(b){a[b]=(a[b]||0)+1}function d(){a.invalid_count=a.invalid_skip_count=0}var g=(new Date).getTime(),e=b.isValid();this.inPenalty.isSatisfiedBy(a)&&!e?(c("invalid_skip_count"),this.penaltyExpired.isSatisfiedBy(a)&&d()):(a.last_collected_at=g,e?d():c("invalid_count"));return a},saveManifest:function(a,b){var c=m(a),d=p.get("expiry"),g=h(c),e=g.value()||{};e[this.platform]=b;g=
h(c);g.value(e);g.expire(d);g.stale(d);g.save()}};return a});
(function(f){BSM.define("when/timeout",["require","./when"],function(d){var e,b,f,c;e=d("./when");try{c=d("vertx"),b=function(a,b){return c.setTimer(b,a)},f=c.cancelTimer}catch(g){b=setTimeout,f=clearTimeout}return function(a,c){if("number"===typeof c){var d=c;c=a;a=d}return e.promise(function(d,g,p){var t=b(function(){g(Error("timed out after "+a+"ms"))},a);e(c,function(a){f(t);d(a)},function(a){f(t);g(a)},p)})}})})("function"===typeof BSM.define&&BSM.define.amd?BSM.define:function(f){module.exports=
f(require)});BSM.define("manifest/bidderkeygen",["config","logger/messages"],function(f,d){var e=f.get("flag/cache_prefix");return function(b,f){if(!b||!f)throw Error(d.BIDDER_KEYGEN_ARGUMENT_ERROR);var c=f.size||"",g=f.pub,a,m=f.pub_zone;a=m&&m.split("/")[0]||"";var m=f.position,p=f.getSection();if(!(b&&c&&g&&a))throw Error(d.BIDDER_KEYGEN_IMPRESSION_ERROR+[b,c,g,a].join("/"));f.isFirstLook()?(c=[e,b,c,g,a].join("/"),c=m&&"unknown"!==m?[c+"/"+m,c]:[c]):c=[[e,b,c,g,a,p,m].join("/")];return c}});
BSM.define("manifest/manifest","logger utils utils/objects when user/cache logger/messages".split(" "),function(f,d,e,b,h,c){function g(a,b){var c=d.$isArray(a)?a.slice(0):[a];this._logger=new f("Manifest["+c[0]+"]");this._userCacheKey=c.shift();this._manifestCacheEntry=h(this._userCacheKey);this._expires=b;this._setSubkeys(c)}g.prototype={_defer:null,_expires:0,_logger:null,_subManifests:null,_subManifestKeys:null,_timer:0,_userCacheKey:"",bindTo:d.$bindTo,_setSubkeys:function(a){for(var b=this._userCacheKey,
c;0<=(c=a.indexOf(b));)a.splice(c,1);this._subManifestKeys=a},_getSubManifests:function(){this._subManifests||(this._subManifests=this._createSubManifests());return this._subManifests},_createSubManifests:function(){var a=this._subManifestKeys,b=[];if(a&&a.length)for(var c=0,d=a.length;c<d;++c)b.push(new g(a[c]));return b},_getSubManifestKeys:function(){for(var a=this._getSubManifests(),b=[],c,d=0,g=a.length;d<g;++d){c=a[d]._keys();for(var e=0,f=c.length;e<f;++e)0>b.indexOf(c[e])&&b.push(c[e])}return b},
_getOwnKeys:function(){return this._manifestCacheEntry.value()||[]},add:function(a,b,d){var g=this._getOwnKeys();d=0<=d?d:this._expires;var e;if(0<=g.indexOf(a))return!1;this._logger.log(c.MANIFEST_ENTRY_ADDED,a,b,d);e=h(a);e.value(b);e.expire(d);e.save();g.push(a);e=h(this._userCacheKey);e.value(g);e.expire(31536E6);e.stale(31536E6);e.save();this._cleanupAfterWait(b);return!0},_cleanupAfterWait:function(a){this._defer&&(this._defer.resolver.resolve(a),this._defer=null,clearInterval(this._timer))},
entries:function(){var a=this._keys();this._keysToValuesInline(a);return a},_keysToValuesInline:function(a){for(var b=0,c=a.length;b<c;++b)a[b]=h(a[b]).value();return a},_keys:function(){var a=this._getOwnKeys(),b=this._getSubManifestKeys();d.dedupe(a);this._removeExpiredKeys(a);for(var c=0,g=b.length;c<g;++c)0>a.indexOf(b[c])&&a.push(b[c]);return a},_removeExpiredKeys:function(a){for(var b=a.length,c,d,g=h(this._userCacheKey);(c=a[--b])&&(d=h(c));)d.value()||a.splice(b,1);g.value(a);g.expire(31536E6);
g.stale(31536E6);g.save();return a},getBest:function(a){return(this.length()?b.resolve():this._waitForOffer()).then(this.bindTo(function(b){return b?b:this._findBest(a)}))},_waitForOffer:function(){var a=this._defer;a||(a=this._defer=b.defer());this._timer=setInterval(this.bindTo(function(){this.length()&&this._cleanupAfterWait()}),50);return a.promise},_findBest:function(a){var b=this.entries();a&&b.sort(a);return b[0]},length:function(){return this._keys().length},remove:function(){var a=this._manifestCacheEntry,
b=a.value(),c;if(e.$isArray(b))for(var d=b.length-1;0<=d;d--)c=new h(b[d]),c.remove();a.remove()}};return g});BSM.define("utils/decorate",[],function(){return function(f,d){for(var e={},b=0,h=d.length;b<h;b++)e[d[b]]=f[d[b]],f[d[b]]=this.bindTo(this[d[b]]);return e}});
BSM.define("bid",["utils","config","microdollar"],function(f,d,e){function b(b,c){this.bidder=c;this.price=new e(b);this.platform=this.bidder.get("platform")}b.prototype={price:null,platform:"",bindTo:f.$bindTo,isValid:function(){return!!this.price&&!!this.price.quantity&&0<this.price.quantity()},expiresIn:function(){return this.bidder.get("expiration")}};return b});
BSM.define("bid/fetcher/decorators/cache","config module logger when manifest/manifest utils/decorate user/cache utils microdollar bid logger/messages".split(" "),function(f,d,e,b,h,c,g,a,m,p,l){function k(a,b){this.logger=new e(a.logger&&a.logger.prefix+"(cacher)");this.fetcher=a;this.bidder=a.bidder;this.manifest=new h(b,this.bidder.get("expiration"));this.whenFetched=this.bindTo(this.whenFetched);this.whenFetchFailed=this.bindTo(this.whenFetchFailed);this.whenReceived=this.bindTo(this.whenReceived);
this.pendingResolvers=[];this.decorating=c.call(this,a,n)}function q(a,b){a="price"in a?a.price:-1E10;b="price"in b?b.price:-1E10;return b-a}var t=f.get("flag/cache_prefix"),n=["abort","getOffer"];k.prototype={bindTo:a.$bindTo,fetcher:null,pendingResolvers:[],platform:"",logger:null,getOffer:function(a,c){var d=b.defer(),g=d.resolver,e=this.pendingResolvers,f=e.push(g)-1;this.manifest.length()<a.minimumOfferCacheSize()&&this.decorating.getOffer.call(this.fetcher,a,c).then(this.whenFetched,this.whenFetchFailed);
this.manifest.getBest(q).then(this.whenReceived).then(g.resolve,g.reject).then(function(){e.splice(f-1,1)});return d.promise},abort:function(){for(var a=this.pendingResolvers,b=0,c=a.length;b<c;b++)a[b].reject(Error(this.logger.prefix+" aborted"))},whenReceived:function(a){a=a||{};a.price=new m(a.price||-1E3);return a},whenFetched:function(a){this.storeCacheContext(a);return a},whenFetchFailed:function(a){var c={price:new m(-1E3),context:{}};this.storeCacheContext(c);return b.reject(a)},storeCacheContext:function(a){var b;
b=(new Date).getTime().toString(36)+Math.floor(1E12*Math.random()).toString(36);b=t+"/"+b;var c=(new p(a.price,this.bidder)).expiresIn(),d=a.context=a.context||{};d.key||(d.key=b);this.logger.log(l.OFFER_CACHED,b,c,a);this.manifest.add(b,a,c)}};k.decorate=function(a,b){new k(a,b)};return k});
BSM.define("bid/fetcher/bidfetcher",["require","module","logger","utils","config"],function(f,d,e,b,h){function c(a){if(!a)return this;this.bidder=a;this.platform=a.get("platform")||"";this.settings=a.get("placement_settings");this.logger=new e(this.platform+"["+ ++g+"]")}var g=0;c.prototype={config:null,aborted:!1,logger:null,platform:"",bindTo:b.$bindTo,getOfferSync:function(a,b){return!1},getOffer:function(){throw"Override me";},abort:function(){this.aborted=!0},getUrlMaker:function(){var a=this.settings.get("urlmaker");
if(a)return a=f(a),new a(this.settings)}};return c});
BSM.define("bid/fetcher/datastructures",["utils","microdollar","offer/displayer/identity"],function(f,d,e){return{createDfpOffer:function(b,d,c){return{price:b,context:{adurl:d,element:c},displayer:new e}},createOrtbBid:function(b,d,c,g,a){return{adid:b,attr:null,price:d,adm:c,adomain:g,ext:a}},createOrtbBidRequest:function(b,d,c,g,a,e,p,l,k,q,t,n,r,u,v){var y=Math.floor(1E12*Math.random()).toString(16),w=Math.floor(1E12*Math.random()).toString(16);b={id:y,at:2,imp:[{id:w,banner:{w:b,h:d,pos:c,topframe:g},
bidfloor:a}],site:{page:e,domain:p},badv:l||[],bcat:k||[],user:{},device:{ip:q,ua:window.navigator.userAgent,js:1}};r&&f.$isArray(r)&&r.length&&(b.site.content={keywords:r.join(", ")});u&&(b.imp[0].banner.battr=u);if("string"===typeof t||"number"===typeof t)b.site.id=t.toString();n&&(b.user.id=n);v&&(b.user.buyeruid=v.toString());return b},createOrtbAdContext:function(b){return{adurl:b.adm,adomain:b.adomain&&b.adomain.length?b.adomain.join(","):"",adid:b.adid,nurl:b.nurl,crid:b.crid,cid:b.cid}},createJsonOffer:function(b,
d){return{context:{adurl:b},price:d}},createNullOffer:function(){return{context:{adurl:""},price:new d(-1E3)}}}});
BSM.define("urlmaker/aol",[],function(){function f(b){this.settings=b;this.makeUrl=d}function d(b){return[this.settings.base_url,this.settings.aol_network_id,this.settings.aol_placement_id,this.settings.aol_page_id,e[b.size||b.sizes[0]],";noperf=1;alias="+(this.settings.aol_alias||"")+";cmd=bid;cors=yes;"].join("/")}var e={"300x250":170,"728x90":225,"160x600":154,"300x600":529,"320x50":3055};f.platform="AOL";return f});
BSM.define("urlmaker/apn",["module","utils","config"],function(f,d,e){function b(b){this.settings=b;this.makeUrl=h}function h(b,g,a,e){e="id="+this.settings.apn_placement_id;var f=d.isWindowHttps()?"secure_url":"url";g=[this.settings[f]+"/"+(a||this.settings.request_type)+"?"+e,"size="+b.sizes.join(","),"position="+b.position,"reserve="+g.getCPM()];b.pageurl&&g.push("referrer="+b.pageurl);g.push("callback=");return g.join("&")}b.platform="APN";return b});
BSM.define("urlmaker/apnh",["module","utils","config"],function(f,d,e){function b(b){this.settings=b||e.namespace(f.id);this.makeUrl=h}function h(b,g){var a;a="id="+parseInt(b.apnh,10);var e=d.isWindowHttps()?"secure_url":"url";a=[this.settings[e]+"/jpt?"+a,"size="+b.sizes.join(",")];a.push("callback=");return a.join("&")}b.platform="APNH";return b});
BSM.define("urlmaker/casale",[],function(){function f(){this.makeUrl=d}function d(){function d(a){var b=g[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}function b(a){c.lastIndex=0;return c.test(a)?a.replace(c,d):a}function f(a,b,c){this.initialized=!1;if("number"!==typeof a||0!==a%1||0>a)throw"Invalid Site ID";"number"===typeof c&&0==c%1&&0<=c&&(this.timeoutDelay=c);this.siteID=a;this.impressions=[];this._parseFnName=void 0;top===self?(this.sitePage=location.href,
this.topframe=1):(this.sitePage=document.referrer,this.topframe=0);if("undefined"!==typeof b)if("function"===typeof b)this._parseFnName="cygnus_index_args.parseFn";else throw"Invalid jsonp target function";_IndexRequestData.requestCounter="undefined"===typeof _IndexRequestData.requestCounter?Math.floor(256*Math.random()):(_IndexRequestData.requestCounter+1)%256;this.requestID=String((new Date).getTime()%2592E3*256+_IndexRequestData.requestCounter+256);this.initialized=!0}var c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
g={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};f.prototype.serialize=function(){var a='{"id":'+this.requestID+',"site":{"page":"'+b(this.sitePage)+'"';"string"===typeof document.referrer&&(a+=',"ref":"'+b(document.referrer)+'"');for(var a=a+'},"imp":[',c=0;c<this.impressions.length;c++){var d=this.impressions[c],g=[],a=a+('{"id":"'+d.id+'", "banner":{"w":'+d.w+',"h":'+d.h+',"topframe":'+String(this.topframe)+"}");"number"===typeof d.bidfloor&&(a+=',"bidfloor":'+d.bidfloor,
"string"===typeof d.bidfloorcur&&(a+=',"bidfloorcur":"'+b(d.bidfloorcur)+'"'));"string"!==typeof d.slotID||d.slotID.match(/^\s*$/)||g.push('"sid":"'+b(d.slotID)+'"');"number"===typeof d.siteID&&g.push('"siteID":'+d.siteID);0<g.length&&(a+=',"ext": {'+g.join()+"}");a=c+1==this.impressions.length?a+"}":a+"},"}return a+"]}"};f.prototype.setPageOverride=function(a){if("string"!==typeof a||a.match(/^\s*$/))return!1;this.sitePage=a;return!0};f.prototype.addImpression=function(a,b,c,d,g,e){var f={id:String(this.impressions.length+
1)};if("number"!==typeof a||1>=a||"number"!==typeof b||1>=b)return null;("string"===typeof g||"number"===typeof g)&&50>=String(g).length&&(f.slotID=String(g));f.w=a;f.h=b;if(void 0!=c&&"number"!==typeof c)return null;if("number"===typeof c){if(0>c)return null;f.bidfloor=c;if(void 0!=d&&"string"!==typeof d)return null;f.bidfloorcur=d}if("undefined"!==typeof e)if("number"===typeof e&&0===e%1&&0<=e)f.siteID=e;else return null;this.impressions.push(f);return f.id};f.prototype.buildRequest=function(){if(0!=
this.impressions.length&&!0===this.initialized){var a=encodeURIComponent(this.serialize()),b="https:"===window.location.protocol?"https://as-sec.casalemedia.com":"http://as.casalemedia.com",b=b+("/headertag?v=9&fn=cygnus_index_parse_res&s="+this.siteID+"&r="+a);"number"===typeof this.timeoutDelay&&0==this.timeoutDelay%1&&0<=this.timeoutDelay&&(b+="&t="+this.timeoutDelay);return b}};try{if("undefined"!==typeof cygnus_index_args&&"undefined"!==typeof cygnus_index_args.siteID&&"undefined"!==typeof cygnus_index_args.slots){"undefined"===
typeof _IndexRequestData&&(_IndexRequestData={impIDToSlotID:{},reqOptions:{}});var a=new f(cygnus_index_args.siteID,cygnus_index_args.parseFn,cygnus_index_args.timeout);cygnus_index_args.url&&"string"===typeof cygnus_index_args.url&&a.setPageOverride(cygnus_index_args.url);_IndexRequestData.impIDToSlotID[a.requestID]={};_IndexRequestData.reqOptions[a.requestID]={};for(var m,p,l=0;l<cygnus_index_args.slots.length;l++)m=cygnus_index_args.slots[l],(p=a.addImpression(m.width,m.height,m.bidfloor,m.bidfloorcur,
m.id,m.siteID))&&(_IndexRequestData.impIDToSlotID[a.requestID][p]=String(m.id));"number"===typeof cygnus_index_args.targetMode&&(_IndexRequestData.reqOptions[a.requestID].targetMode=cygnus_index_args.targetMode);"function"===typeof cygnus_index_args.callback&&(_IndexRequestData.reqOptions[a.requestID].callback=cygnus_index_args.callback);return a.buildRequest()}}catch(k){}}f.platform="CASALE";return f});
BSM.define("urlmaker/criteo",[],function(){function f(b){this.config=b;this.makeUrl=d}function d(b,d){var c=""+b.criteo_nid,g=e[c],a=this.config.get("cookie_name"),f=this.config.get("url");if(g)return g;g=["netId="+c,"cookieName="+a,"rnd="+Math.floor(99999999999*Math.random()),"varName="];f=f+"?"+g.join("&");return e[c]=f}var e={};f.platform="CRITEO";return f});
BSM.define("urlmaker/mpm",[],function(){function f(b){this.config=b;this.makeUrl=d}function d(d,c){d||(d={mpm:"",mpm_pub_id:-1,mpm_site_id:-1});var g=this.config.get("uripath")||"",a=this.config.get("hostname"),f=(d.size||"").replace("x","-")+"-"+ ++b,p=d.mpm_pub_id,l=d.mpm_site_id,f=["prm="+d.mpm,"id=banner-"+f,"pos="+ ++e,"jsonp="];g&&"/"===g[0]||(g="/"+g);"/"!==g[g.length-1]&&(g+="/");return"//"+a+g+p+"/"+l+"?"+f.join("&")}var e=0,b=0;f.platform="MPM";return f});
BSM.define("urlmaker/oxm",["module","microdollar","utils","config"],function(f,d,e,b){function h(){this.config=b.namespace(f.id);this.makeUrl=c}function c(b,a){return b.url+"/"+b.request_type+"?nc="+b.oxm_pubId}h.platform="OXM";return h});
BSM.define("urlmaker/pbm",["utils","module","config","microdollar"],function(f,d,e,b){function h(a){this.config=a||e.namespace(d.id);this.makeUrl=c}function c(a,c){c=c||new b(0);var d=a.size.split("x"),e=new Date,f;f=[e.getUTCFullYear(),e.getMonth()+1,e.getDate()];for(var h=[e.getHours(),e.getMinutes(),e.getSeconds()],t=0;t<h.length;t++)h[t]=g(h[t]);f=f.join("-");h=h.join(":");f=f+" "+h;var h=a.firstLook?(new b(a.fl_soft_floor)).getCPM():c.getCPM(),t=a[this.config.get("pub_key")],n=a[this.config.get("site_key")],
r=a[this.config.get("context_key")],e=(e.getTimezoneOffset()/60).toFixed(2).split(".");e[0]=g(e[0]);var e=e.join("."),u;u=this.config;u=u.get("url")+"/"+u.get("request_type")+"?operId=102";var v=window.screen.availWidth+"x"+window.screen.availHeight,d=[u,"pubId="+t,"siteId="+n,"adId="+r,"kadwidth="+parseInt(d[0],10),"kadheight="+parseInt(d[1],10),"pageURL="+a.pageurl,"kadfloor="+h,"kltstamp="+encodeURIComponent(f),"ranreq="+Math.random(),"timezone="+encodeURIComponent(e),"screenResolution="+v,"inIframe=1",
"adPosition=-1x-1","adVisibility=0"];d.push("rs=3");d.push("battr=1,2,3,5,6,7,8,9,10,11,13,14,44");d.push("rid=");return d.join("&")}function g(a){return 0<=a?10>a?"0"+a:a:-10<a?"-0"+a.toString().substr(1):a}h.platform="PBM";return h});BSM.define("urlmaker","./urlmaker/aol ./urlmaker/apn ./urlmaker/apnh ./urlmaker/casale ./urlmaker/criteo ./urlmaker/mpm ./urlmaker/oxm ./urlmaker/pbm".split(" "));
BSM.define("bid/fetcher/json","module require window microdollar utils when ./bidfetcher ./datastructures urlmaker".split(" "),function(f,d,e,b,h,c,g,a){function m(a){g.call(this,a);a&&(a=c.defer(),this.promise=a.promise,this.resolver=a.resolver)}m.prototype=h.mixin(new g,{promise:null,resolver:null,callbackPrefix:"",getOffer:function(a,b){var d="c"+Math.floor(1E8*Math.random()),g,f;try{g=this.getUrlMaker(this.settings),f=g.makeUrl(a,b,null,this.platform)}catch(m){return c.reject(m)}f+=d;d=this.callbackPrefix+
d;(function(a){e[a]=function(b){e[a]=b}})(d);h.$script(f).then(function(){var a=e[d];e[d]=void 0;return a}).then(this.bindTo(this.buildOffer)).then(this.bindTo(this.buildResult)).then(this.resolver.resolve,this.resolver.reject);return this.promise},buildOffer:function(a){if(a&&a.result)return a.result;throw Error("invalid offer data or missing result: "+a);},buildResult:function(c){var d=c.ad;c=parseInt(c.cpm,10);c=new b(Math.round((d?c:-1E4)/10));return a.createJsonOffer(d,c)},getUrlMaker:function(a){return new (d(a.urlmaker))(a)}});
return m});BSM.define("bid/fetcher/apn","module when utils microdollar bid/fetcher/json offer/displayer/identity".split(" "),function(f,d,e,b,h,c){function g(a){h.call(this,a)}g.prototype=e.mixin(new h,{bindTo:e.$bindTo,getOffer:function(a,b){return h.prototype.getOffer.call(this,a,b)}});return g});BSM.define("impression/displayer/casale",["config"],function(f){return function(d){return"<script>window.top.index_render( document, '"+d+"')\x3c/script>"}});
BSM.define("model/event/gpt/settargeting",[],function(){function f(d){for(var e in f.prototype)e in d&&(this[e]=d[e]);this.event_key&&(this.event_name="gpt.setTargeting."+this.event_key)}f.prototype={key:null,value:null};f.prototype.event_name="gpt.setTargeting";f.prototype.event_key="";return f});
BSM.define("bid/fetcher/casale","when utils utils/msgs ./bidfetcher impression/displayer/casale urlmaker/casale microdollar module model/event/gpt/settargeting".split(" "),function(f,d,e,b,h,c,g,a,m){function p(a,c){b.call(this,a);var d=f.defer();this.promise=d.promise;this.resolver=d.resolver;window.cygnus_index_args||(d=this.settings,window.cygnus_index_args={embedMode:d.embedMode||0,timeout:d.timeout||300,siteID:d.casale_siteID,slots:[]});this.slotID=this.settings.casale_placement_id;var g=this.settings,
d=g.casale_placement_id,g=g.casale_siteID,e=c.size.split("x"),k=parseInt(e[0]),e=parseInt(e[1]);window.cygnus_index_args.slots.push({id:d,width:k,height:e,siteID:g})}function l(){var a=q();if(a.length){e.fire(new m({key:"IPM",value:a}));var b=window.googletag||{};b.cmd=window.googletag.cmd||[];b.cmd.push(function(){gt.pubads().setTargeting("IPM",a)})}}function k(){var a,b=this.slotID;a=window.index_slots_last||[];for(var c="",d=0;d<a.length;d++){var g=a[d],e=g.split("_")[1]||"";e&&b===e&&(c=g)}a=
c;b=-1E3;c="";"O"===(a.split("_")[0]||"")&&(b=a.split("_")[2]||-1E3,a=a.split("_"),a.shift(),a=a.join("_"),c=h(a));this.resolver.resolve(t(b,c))}function q(){for(var a=[],b=window.index_slots_last||[],c=0;c<b.length;c++){var d=b[c];"P"===(d.split("_")[0]||"")&&a.push(d)}return a}function t(a,b){return{price:new g(a),context:{adurl:b}}}var n=!1;p.prototype=d.mixin(new b,{promise:null,resolver:null,getOffer:function(a,b){if(!n){var g=(new c).makeUrl();n=d.$script(g).then(this.bindTo(l))}n.ensure(this.bindTo(k));
return this.promise}});return p});
BSM.define("impression/displayer/criteo",["config","window","document"],function(f,d,e){f=f.namespace("impression/displayer/criteo");var b=d.encodeURIComponent||function(b){return b},h='<script src="'+f.get("baseUrl")+'?{{QUERY}}">\x3c/script>';return function(c){var d=e.charset||e.characterSet||"";c=["zoneid="+(c?c.criteo:""),"nodis=1","cb="+Math.floor(1E9*Math.random()),"charset="+d,"loc="+b(c.page_url)];","!=e.MAX_used&&c.push("exclude="+e.MAX_used);e.referrer&&c.push("referer="+b(e.referrer));
e.context&&c.push("context="+b(e.context));"undefined"!==typeof e.MAX_ct0&&0==e.MAX_ct0.indexOf("http")&&c.push("ct0="+b(e.MAX_ct0));e.mmm_fo&&c.push("mmm_fo=1");return h.replace("{{QUERY}}",c.join("&"))}});
BSM.define("bid/fetcher/criteo","module config logger microdollar utils when bid/fetcher/bidfetcher impression/displayer/criteo urlmaker/criteo user/cache".split(" "),function(f,d,e,b,h,c,g,a,m,p){function l(a){g.apply(this,arguments)}function k(a){return h.$script(a).then(function(){var a=window.crtg_content,b={};if("string"!==typeof a)throw Error("#processCriteoGlobal(): global not set by remote script");a=a.split(";");""===a[a.length-1]&&a.pop();for(var c=0,d=a.length;c<d;++c){var g=b,e=a[c],f=
e.indexOf("="),k=e.slice(0,f),e=e.slice(f+1);"1"===e&&p(t+"/"+k).value(1).expire(n).save();g[k]=e}return b})}function q(b,c,d){b={price:b,context:{adurl:""}};d&&(b.context.adurl=a(d));c&&(b.context.key=c);return b}f=d.namespace("bid/fetcher/criteo");f.get("cache_key_loading");var t=f.get("cache_slot_prefix"),n=f.get("cache_key_loading_expire"),r;l.prototype=h.mixin(new g,{mustFill:function(){return!1},getOffer:function(a){var d=c.defer(),g=a.criteo_nid,e=a.criteo_key,f=a.criteo_floor,h=t+"/"+e,l=
new b(f),n=new b(-1E3),z=q(l,h,a),C=q(n);if(!function(){var a=g&&f&&e,b=0<l.quantity();return a&&b}())return c.resolve(C);a.flag?(a=p(h).value()?z:C,d.resolver.resolve(a)):a.firstLook?(r||(a=(new m(this.settings)).makeUrl(a)+"crtg_content",r=k(a)),r.then(function(a){a="1"===a[e]&&p(h).value()?z:C;d.resolver.resolve(a)}).otherwise(function(){d.resolver.resolve(C)})):d.resolver.resolve(C);return d.promise}});return l});
BSM.define("bid/loaddfp",["module","config","utils"],function(f,d,e){function b(){c||(h(),c=!0)}function h(){e.$script(a);m.cmd.push(function(){m.pubads().collapseEmptyDivs();m.pubads().enableAsyncRendering();m.pubads().enable()})}var c=!1,g=d.get(f.id+"/gpt_ns"),a=d.get(f.id+"/gpt_url"),m=window[g]=window[g]||{cmd:[]};b.googleTag=m;return b});
BSM.define("bid/fetcher/dfp","logger microdollar utils when bid/fetcher/bidfetcher ../loaddfp bid/fetcher/datastructures window document module utils/msgs logger/messages".split(" "),function(f,d,e,b,h,c,g,a,m,p,l,k){function q(a){c();h.call(this,a);var d=b.defer();a=this.settings||a.get("placement_settings");this.ceiling=a.ceiling;this.increments=a.increments;this.postreadywaittime=a.postreadywait;this.resolver=d.resolver;this.promise=d.promise;this.promise.ensure(this.bindTo(this.unregisterMessageHandler))}
var t={};q.prototype=e.mixin(new h,{ceiling:0,completed:!1,context:null,element:null,id:"",increments:0,messageHandler:null,offer:null,postreadywaittime:0,promise:null,rendered:!1,reserve:null,resolver:null,getOffer:function(a,b){var c=b.quantity(),c=c+this.increments-c%this.increments;this.context=a;this.reserve=new d(c);if(this.aborted||!this.getUnit()||c>this.ceiling)return this.rejectOffer(Error(p.id+": getOffer() called after abort"));this.registerMessageHandlers();this.makeElement();this.sendDfpCall();
return this.promise},rejectOffer:function(a){this.removeElement();a=a||Error(p.id+": offer request rejected");return this.resolver.reject(a)},sendOffer:function(){this.completed=!0;var a=g.createDfpOffer(this.reserve,this.element.id,this.element);this.resolver.resolve(a)},sendDfpCall:function(){c.googleTag.cmd.push(this.bindTo(this.onGpt))},onGpt:function(){this._buildSlot()},abort:function(){if(!this.completed){var a=Error(p.id+": in-flight request aborted");this.aborted=!0;this.rejectOffer(a)}},
removeElement:function(){if(this.element&&this.element.parentNode){for(var a=this.element.getElementsByTagName("iframe"),b=0,c=a.length;b<c;b++)try{this._stopFrame(a[b])}catch(d){}this.element.parentNode.removeChild(this.element)}},makeElement:function(){if(this.element)return this.element;var a=this.context.container.appendChild(m.createElement("div"));a.id=this.getId();return this.element=a},getUnit:function(){if(this.unit)return this.unit;if(!this.context)return"";var a=this.settings.dfp_placement_id;
0===a.indexOf("/")&&(a=a.substring(1));return this.unit=a},getId:function(){if(this.id)return this.id;if(!this.context)return"";for(var a=0,b=["bsm_cx/dfp",this.getUnit(),this.context.sizes[0],a];b.join("/")in t;)b[b.length-1]=++a;this.id=b.join("/");t[this.id]=!0;return this.id},_buildSlot:function(){var a=this.context,b=this.reserve.quantity(),d=a.sizes[0].split("x"),g=parseInt(d[0],10),e=parseInt(d[1],10),d=this.getId(),f=this.getUnit(),k=c.googleTag,h=k.pubads(),b=k.defineSlot(f,[g,e],d).addService(h).set("page_url",
decodeURIComponent(a.pageurl)).setTargeting("cxid",d).setTargeting("cximp",a.id).setTargeting("reserve",b),l=this,m=b.renderEnded;b.renderEnded=function(){l._onRenderEnd();"function"==typeof m&&m.apply(this,arguments)};if(!h.enableAsyncRendering())return this.rejectOffer(Error("GPT async unavailable"));for(var p in a.kv)b.setTargeting(p,a.kv[p].toString());k.enableServices();k.display(d)},_onRenderEnd:function(){function a(){l||(h=setTimeout(b,k))}function b(){l||(l=!0,g.sendOffer())}function c(a){if(!l)return l=
!0,clearTimeout(h),g.rejectOffer(a)}var d=this.element,g=this,f=d.getElementsByTagName("iframe")[0],k=this.postreadywaittime,h=0;this.getId();var l=!1,f=f.contentWindow.document;this.rendered=!0;"none"===d.style.display?c(Error(p.id+": slot hidden indicating rejection")):e.$whenReady(f).always(a)},_stopFrame:function(a){var b=a.contentWindow||a.contentDocument&&a.contentDocument.window;a=b.document||a.contentDocument||a.contentWindow.document;b&&b.stop?b.stop():a&&a.execCommand&&a.execCommand("Stop")},
registerMessageHandlers:function(){var b=this.messageHandler=this.bindTo(this.onMessage);a.addEventListener?a.addEventListener("message",b,!1):a.attachEvent&&a.attachEvent("onmessage",b)},onMessage:function(b){b=b||a.event;b=b.data;var c=this.settings.pixel_key,d=b.indexOf(c),e=b.indexOf("=no"),c=c.length;0>d||e<d?b=!1:(b=b.substr(d+c,e-d-c).split("|"),b=b.pop()||"");b&&(this.resolver.resolve(g.createNullOffer()),this.removeElement())},unregisterMessageHandler:function(){a.removeEventListener?a.removeEventListener("message",
this.messageHandler,!1):a.detachEvent&&a.detachEvent("onmessage",this.messageHandler);this.messageHandler=null}});return q});
BSM.define("bid/fetcher/mpm",["module","utils","microdollar","bid/fetcher/json","bid/fetcher/datastructures"],function(f,d,e,b,h){function c(c){b.call(this,c)}c.prototype=d.mixin(new b,{buildOffer:function(b){if(b&&"object"===typeof b)return b;throw Error("no or invalid offer data received: "+b);},buildResult:function(b){var a=b.bid_cpm,c=b.notify;b=this.settings.notify_url;var f=h.createJsonOffer;if(!a||!c)return h.createNullOffer();c={id:c,price:a,rand:Math.floor(1E12*Math.random())};b+=d.$toString(c,
"=","&");return f('<script src="'+b+'">\x3c/script>',new e(1E3*a))}});return c});BSM.define("bid/fetcher/null","module microdollar utils when ./bidfetcher config".split(" "),function(f,d,e,b,h,c){function g(a){if(!arguments.length)return this;h.call(this,a)}g.prototype=e.mixin(new h,{getOffer:function(){return b.resolve(this.getNullBid())},mustFill:function(){return!1},getNullBid:function(){return{context:null,price:new d(-1E3)}}});return g});
BSM.define("bid/filter",["config","utils","user/cache"],function(f,d,e){function b(b){this.impressionContext=b}f=f.namespace("aq/loader");var h=f.get("expireTime"),c=f.get("staleTime");b.prototype={impressionContext:null,filterBids:function(b){for(var a=[],c=0,d=b.length,e;c<d;c++)e=b[c],this.isAllowed(e)&&a.push(e);return a},isAllowed:function(b){if(!d.isObject(b))return!0;var a="attr"in b&&d.$isArray(b.attr)?b.attr:[];b="adomain"in b&&d.$isArray(b.adomain)?b.adomain:[];for(var c=this.impressionContext.battr,
e=this.impressionContext.badv,f=0,k=a.length;f<k;f++)if(0<=c.indexOf(a[f]))return!1;a=0;for(c=b.length;a<c;a++)if(0<=e.indexOf(b[a]))return this.rememberBlockedDomain(b[a]);return!0},rememberBlockedDomain:function(b){var a=e("block_freq-"+this.impressionContext.aq_url),d;if(!a.lockPartial())return!1;(d=a.value())||(d={});d[b]?++d[b]:d[b]=0;a.value(d).expire(h).stale(c).release();return!1},isBlocked:function(b){return!this.isAllowed(b)}};return b});
BSM.define("aq/loader","module config logger utils when user/cache".split(" "),function(f,d,e,b,h,c){function g(a){b.$isArray(a.badv)||(a.badv=[]);b.$isArray(a.battr)||(a.battr=[]);b.$isArray(a.bcat)||(a.bcat=[])}function a(a,c){if(b.$isArray(a))for(var d=0,e=a.length;d<e;++d)0>c.indexOf(a[d])&&c.push(a[d])}var m=d.namespace(f.id);return{fromCache:function(b){var d=b.aq_url;g(b);if(d){a:{var e=b.badv,f;try{f=c("block_freq-"+d)}catch(h){break a}if(!f.expire()&&!f.stale()&&(f=f.value()))for(var m in f)f.hasOwnProperty(m)&&
0<f[m]&&0>e.indexOf(m)&&e.push(m)}a:{var r;try{r=c(d)}catch(u){break a}r.expire()||r.stale()||!(d=r.value())||(a(d.battr,b.battr),a(d.bcat,b.bcat))}}},fromRemote:function(b){var d=b.aq_url;g(b);return d?c(d).fetch({provider:function(){var a=window.bsm_tag;return a&&a.adquality},expire:m.get("expireTime"),stale:m.get("staleTime")}).then(function(c){a(c.badv,b.badv);a(c.bcat,b.bcat);a(c.battr,b.battr);return b}).otherwise(function(a){(new e("aqloader#fromRemote")).warn("Failed to fetch aq data from %s because: %o",
d,a);return b}):h.resolve(b)}}});
BSM.define("utils/proxy",["document","when"],function(f,d){function e(b,a){return function(e){var f,h;try{h=e.bidrequest.id,f=JSON.stringify(e)}catch(k){return d.reject(k)}e=d.defer();b.postMessage(f,a);c[h]=e.resolver;return e.promise}}var b={},h={},c={};(function(b){window.addEventListener?window.addEventListener("message",b,!1):window.attachEvent&&window.attachEvent("onmessage",b)})(function(b){b=b||window.event;var a=b.data,d;try{d=JSON.parse(a)}catch(f){return f}if("synack"===d.type){d=b.source;
b=b.origin;a:{var a=b,a=a.slice(a.indexOf("//")),a=h[a],l;if(a&&a.length)for(var k=0,q=a.length;k<q;k++)if(l=a[k],l.source===d){a=l.resolver;break a}a=null}a&&a.resolve(e(d,b))}else b=d.message||{},(d=c[d.request_id||b.id])&&d.resolve(b)});return function(c){if(c in b)return b[c];var a=f.createElement("iframe"),e=f.getElementsByTagName("script")[0],p=c.split("/").slice(0,3).join("/").toLowerCase(),l=d.defer(),p=p.slice(p.indexOf("//"));a.style.display="none";a.src=c;e.parentNode.insertBefore(a,e);
a={resolver:l.resolver,source:a.contentWindow};h[p]=h[p]||[];h[p].push(a);b[c]=l.promise;return b[c]}});
BSM.define("utils/xhr",["when"],function(f){return function(d,e){var b=f.defer(),h=b.resolver;if(!window.XMLHttpRequest)return f.resolve(null);transport=new XMLHttpRequest;transport.onreadystatechange=function(){var b=null;if(4==this.readyState){if(this.responseType&&"json"===this.responseType)b=this.response;else if(200===this.status)try{b=JSON.parse(this.response||this.responseText)}catch(d){}this.onreadystatechange=this.onerror=null;h.resolve(b)}};transport.onerror=function(b){this.onreadystatechange=
this.onerror=null;h.resolve(null)};transport.open("GET",d);"withCredentials"in transport&&(transport.withCredentials=!0);e=JSON.stringify(e);transport.send(e);return b.promise}});BSM.define("navigator",[],function(){return navigator});
BSM.define("bid/fetcher/ortb","module require window document microdollar utils utils/friendlyiframe when ./bidfetcher ./null user user/cache bid/filter aq/loader utils/proxy utils/xhr ./datastructures navigator".split(" "),function(f,d,e,b,h,c,g,a,m,p,l,k,q,t,n,r,u,v){function y(c){if(!e.postMessage||b.documentMode&&!(7<b.documentMode)||"Microsoft Internet Explorer"==v.appName&&b.domain!==e.location.hostname)return new p(c);m.call(this,c);this.multiplier=this.settings.price_multiplier;this.defer=
a.defer()}function w(a){var b=[u.createOrtbBid(0,-100,"",[],{})],c;if(!a||!a.seatbid||!a.seatbid.length)return b;a=a.seatbid||[];for(var d=0,e=a.length;d<e;d++){c=a[d]&&a[d].bid||[];for(var f=0,g=c.length;f<g;f++)b.push(c[f])}return b}function A(a){if(a.ext&&a.ext.pixels){var c=a.ext.pixels;if(x[c])return a;var d=b.getElementsByTagName("script")[0],d=d&&d.parentNode||b.getElementsByTagName("head")[0];g(c,d,{width:1,height:1});x[c]=!0}return a}function B(a,b){return(new q(a)).filterBids(b)}function F(a,
b){return b({type:"bidrequest",bidrequest:a})}var x={};y.prototype=c.mixin(new m,{defer:null,getOffer:function(b,e){e=e||new h(0);t.fromCache(b);var f=l.getPartnerId(this.settings.uid),g=this.getBidRequest(b,e,f);a.all([t.fromRemote(b),function(a){a.is_cors?(a=(new (d(a.urlmaker))(a)).makeUrl(b),a=r(a,g)):a=n(a.xd_url).then(c.$bind(null,F,g));return a}(this.settings).then(A).then(w)]).spread(B).then(this.bindTo(this.buildOffer)).then(this.defer.resolver.resolve,this.defer.resolver.reject);return this.defer.promise},
buildOffer:function(a){for(var b=-1E6,c,d,e=0,f=a.length;e<f;e++)!(d=a[e])||d.price<=b||(b=d.price,c=d);a=c;b=u.createOrtbAdContext(a);return{price:new h(((a?a.price:-100)*this.multiplier).toFixed(0)),context:b}},getBidRequest:function(a,b,c){a.isFirstLook()&&(b=new h(a.fl_soft_floor));var d=decodeURIComponent(a.pageurl),f;f=d.split("/").slice(2,3).join("/").split(".");f=2>f.length?"":f.slice(f.length-2,f.length).join(".");var g=this.getSiteId(a),m=a.size.split("x"),p=a.positionIndex;b=b.getCPM();
var n=e==e.top?1:0,q=l.getId(),v=l.getIp(),t;a:{var r=k("block_freq-"+a.aq_url),w=[];try{t=r.value()}catch(y){t="";break a}for(var x in t)r=x,t.hasOwnProperty(r)&&"undefined"!==r&&-1<t[r]&&w.push(x);t=w}return u.createOrtbBidRequest(parseInt(m[0],10),parseInt(m[1],10),p,n,b,d,f,t,a.bcat,v,g,q,a.kw,a.battr,c)},getSiteId:function(a){return a[this.platform]||""}});return y});
BSM.define("bid/fetcher/oxm","when utils ./bidfetcher urlmaker/oxm ./datastructures microdollar module".split(" "),function(f,d,e,b,h,c,g){function a(a,b){e.call(this,a);var c=f.defer(),d=this.settings.oxm_placement_id,g="oxm_"+b.id+"_"+d,h=b.oxm_targeting;this.promise=c.promise;this.resolver=c.resolver;this.bidder=a;this.requestId=g;c=[d,b.sizes,g];h&&c.push({pos:[h]});window.OX_dfp_ads=window.OX_dfp_ads||[];window.OX_dfp_ads.push(c)}function m(a){var b=a.ad;a=10*parseInt(a.price,10);a=new c(Math.round(b?
a:-1E3));return h.createJsonOffer(b,a)}var p=!1;a.prototype=d.mixin(new e,{promise:null,resolver:null,getOffer:function(a,c){var e=(new b).makeUrl(this.settings),g=this;if(p)p.then(function(){g.buildResult(OX.dfp_bidder.getPriceMap())});else{var h=f.defer();window.oxDone=function(){g.buildResult(OX.dfp_bidder.getPriceMap());h.resolver.resolve()};p=h.promise;d.$script(e).then(function(){}).otherwise(function(){g.buildResult({})})}return this.promise},buildOffer:function(a){},buildResult:function(a){a=
a[this.requestId];if(!a)return this.resolver.resolve(m({}));this.resolver.resolve(m(a))}});return a});
BSM.define("bid/fetcher/pbm",["module","utils","microdollar","./bidfetcher","./json"],function(f,d,e,b,h){function c(b){h.call(this,b)}c.prototype=d.mixin(new h,{callbackPrefix:"pubMaticBid_",buildOffer:function(b){if(!("object"===typeof b&&"PubMatic_Bid"in b&&"object"===typeof b.PubMatic_Bid)||"error_code"in b.PubMatic_Bid&&b.PubMatic_Bid.error_code)throw Error("Offer data invalid");return b.PubMatic_Bid},buildResult:function(b){var a=b.creative_tag,c=1E3*b.ecpm,c=new e(a?c:-1E4);return{context:{adurl:a,
nurl:b.tracking_url},price:c}}});return c});
BSM.define("bid/fetcher/tag",["module","when","utils","./bidfetcher","microdollar"],function(f,d,e,b,h){function c(){b.apply(this,arguments)}function g(a,b,c){a={price:new h(a),context:{adurl:b}};c&&(c.type="sync",a.displayer=c);return a}c.prototype=e.mixin(new b,{context:null,abort:function(){},getOffer:function(a,b){var c=this.bidder.get("bias"),c=this.checkOffer(this.settings,c,b,void 0);return d.resolve(c)},checkOffer:function(a,b,c,d){if(!a)return g(-1E3,"",d);var e=a.tag;a=g(a.price,e,d);b=
a.price.clone().multiplyBy(b);c.gt(b)&&(a=g(-1E3,e,d));return a}});return c});
BSM.define("impression/displayer/xaxis",["config"],function(f){var d=f.namespace("impression/displayer/xaxis").get("slot_ids");return function(e,b){var f=d[b];return'<span id="TFSA_'+f+"\"><script type=\"text/javascript\">var tfsa_click = '[PUBLISHER CLICK MACRO]';var tfsa_imp = '[PUBLISHER IMPRESSION MACRO]'; var tfsa_pb = 'http://cdn.beanstock.com/pub/px/bsmpixel.js?no';var tfsa_pbt = 'j';var tfsa_uid = '[USER ID]';var tfsa_pub = '"+e+"';var tfsa_pos = '"+f+"';tfsa_rn = new String(Math.random());tfsa_rns = tfsa_rn.substring (2,12);document.write('<scr' + 'ipt type=\"text/javascript\" src=\"//network.realmedia.com/2/247-Access/Pub/"+
e+"/' + tfsa_rns + '@x96?\"></scr' + 'ipt>');\x3c/script></span>"}});
BSM.define("bid/fetcher/xaxis","module when utils utils/msgs ./bidfetcher microdollar bid/fetcher/datastructures impression/displayer/xaxis offer/displayer/friendly logger/messages".split(" "),function(f,d,e,b,h,c,g,a,m,p){function l(){h.apply(this,arguments);this.defer=d.defer();this.sendRejectOffer=this.bindTo(this.sendRejectOffer)}function k(a,b){return{price:new c(a),context:{adurl:"",displayer:b}}}l.prototype=e.mixin(new h,{context:null,displayer:null,fulfilled:!1,iframe:null,defer:null,offerAmount:0,
timer:0,abort:function(){this.sendRejectOffer()},mustFill:function(){return!0},getOffer:function(a,b){if(b.quantity()>this.offerAmount)return this.sendRejectOffer();this.offerAmount=this.settings.floor;this.embedTag();return this.defer.promise},sendValidOffer:function(a){if(this.fulfilled)return this.defer.promise;this.fulfilled=!0;this.iframe=a;var b=this.defer,c=this.offerAmount,d=this.displayer;this.timer=window.setTimeout(function(){b.resolver.resolve(k(c,d))},this.settings.postreadywait)},sendRejectOffer:function(){var a=
this.defer.resolver,c=this.context&&this.context.id||"";if(this.fulfilled)return this.defer.promise;this.fulfilled=!0;window.clearTimeout(this.timer);this.iframe&&this.iframe.parentNode&&(this.iframe.parentNode.innerHTML="");b.off(["offer.revoked",c],this.sendRejectOffer);return a.resolve(g.createNullOffer())},embedTag:function(){var c=this.context,d=a(this.settings.xaxis_placement_id,c.size),e=this.displayer=new m;b.on(["offer.revoked",c.id],this.sendRejectOffer);e.display(d,c).then(this.bindTo(this.sendValidOffer))}});
return l});BSM.define("impression/displayer/yieldbot",["config"],function(f){var d=f.get("impression/displayer/yieldbot/lib_url");return function(e,b){return'<script type="text/javascript" src="'+d+'">\x3c/script><script type="text/javascript">var ybotq = ybotq || [];ybotq.push(function () {yieldbot.renderAd("'+(e+":"+b)+'");});\x3c/script>'}});
BSM.define("bid/fetcher/yieldbot","module logger config microdollar utils when window document bid/fetcher/bidfetcher impression/displayer/yieldbot user/cache".split(" "),function(f,d,e,b,h,c,g,a,m,p,l){function k(b){g.ybotq||(g.ybotq=[]);m.call(this,b);if(!g.yieldbot){var c=this.settings.lib_url;b=a.createElement("script");b.src=c;c=a.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}}function q(a,b,c){a=a||{};var d=a.pub_id,e=a.slots,f=a.cache_key_loading,g=a.cache_slot_prefix,h=
a.cache_key_loading_expire,k={};a=l(f);r(function(){yieldbot.pub(d)});a.raw.value&&!a.expire()||!a.lock()||(u(e,function(a){r(function(){yieldbot.defineSlot(a);l(g+"/"+a).value(1).expire(h).save()})}),r(function(){yieldbot.enableAsync();yieldbot.go()}),r(function(){l(f).release().value(1).expire(h).save()}));a.valueAnd().then(function(a){r(function(){u(e,function(a){k[a]=yieldbot.getSlotCriteria(a)});c(k)})});t(f,g)}function t(a,b){function c(){l(a).remove();for(var d in localStorage)~d.search(b)&&
localStorage.removeItem(d)}window.addEventListener?window.addEventListener("unload",c):window.attachEvent?window.attachEvent("onbeforeunload",c):window.onbeforeunload=c}function n(a,c){var d=new b(a.price);return 0<d.quantity()?{price:d,context:{adurl:p(a.slot,a.size),key:c+"/"+a.slot}}:{price:new b(-1E3),context:{adurl:""}}}function r(a){g.ybotq.push(a)}function u(a,b){if(a&&"function"===typeof b)for(var c in a)b(a[c],c)}k.prototype=h.mixin(new m,{defer:null,getOffer:function(a){var b=c.defer(),
d=this.settings;this.defer=b;if(!d||!d.slots||!d.slots[a.size])return b.resolve(n({}));q(d,a,function(c){var e,f=d||{};e=f.cache_slot_prefix;var f=f.slots[a.size],g={};c&&l(e+"/"+f).value()&&(g=(c=c[f])?{price:c.ybot_cpm||-1E3,size:c.ybot_size,slot:c.ybot_slot}:{});e=n(g,e);b.resolver.resolve(e)});return b.promise},getOfferSync:function(){this.logger.error("getOfferSync not supported");throw Error("not supported");},mustFill:function(){return!1}});return k});
BSM.define("bid/fetcher/sync/apn","module when utils microdollar bid/fetcher/json offer/displayer/identity".split(" "),function(f,d,e,b,h,c){function g(a){h.call(this,a)}g.prototype=e.mixin(new h,{bindTo:e.$bindTo,getOffer:function(a,e){var f=d.defer(),g='<script src="'+(h.prototype.getUrlMaker(this.settings).makeUrl(a,e,"ttj",this.platform)+Math.floor(1E8*Math.random()))+'" onload="BSM.__scriptLoaded__.apply(this)" onreadystatechange="BSM.__scriptLoaded__.apply(this)">\x3c/script>',k=new c(f.promise),
g={price:new b(1),context:{adurl:g},displayer:k};g.displayer.type="sync";BSM.__scriptLoaded__=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(this.onload=this.onreadystatechange=null,BSM.__scriptLoaded__=function(){},f.resolver.resolve(this))};return g}});return g});BSM.define("bid/fetcher/sync/null",["utils","bid/fetcher/null"],function(f,d){function e(){}e.prototype=f.mixin(new d,{getOffer:function(){return this.getNullBid()}});return e});
BSM.define("bid/fetcher/sync/tag",["utils","when","bid/fetcher/tag","offer/displayer/identity"],function(f,d,e,b){function h(b){e.call(this,b)}h.prototype=f.mixin(new e,{getOffer:function(c,e){var a=new b(d.resolve()),f=this.bidder.get("bias");return this.checkOffer(this.settings,f,e,a)}});return h});
BSM.define("bid/fetcher/factory","module require logger manifest/bidderkeygen bid/fetcher/decorators/cache bid/fetcher/apn bid/fetcher/bidfetcher bid/fetcher/casale bid/fetcher/criteo bid/fetcher/datastructures bid/fetcher/dfp bid/fetcher/json bid/fetcher/mpm bid/fetcher/null bid/fetcher/ortb bid/fetcher/oxm bid/fetcher/pbm bid/fetcher/tag bid/fetcher/xaxis bid/fetcher/yieldbot bid/fetcher/sync/apn bid/fetcher/sync/null bid/fetcher/sync/tag".split(" "),function(f,d,e,b,h){function c(){}function g(b,
c){var e=null;b=[c,b].join("/");try{e=d(b)}catch(f){return a.error('cannot require fetcher "'+b+'": '+f.message),g("null",c)}return e}var a=new e(f.id);c.prototype.build=function(a,c){var d=a.shouldFetch(c.context)?a.get("bidder_type"):"null",d=new (g(d,this.path))(a,c.context),e=a.get("placement_id"),e=b(e,c.context),f=c.context;return f.useCache()&&(f.isFirstLook()?a.get("flag"):a.get("cacheable"))?new h(d,e):d};c.prototype.path="bid/fetcher";return c});
BSM.define("bid/fetcher/sync/factory",["module","bid/fetcher/factory","utils"],function(f,d,e){function b(){}b.prototype=e.mixin(new d,{path:function(b){b=b.split("/");return b.splice(0,b.length-1).join("/")}(f.id)});return b});
BSM.define("service/bidfetcher","module when logger logger/messages when/timeout bid/fetcher/factory bid/fetcher/sync/factory offer utils utils/msgs".split(" "),function(f,d,e,b,h,c,g,a,m,p){function l(){this.fetchBid=this.bindTo(k);this.fetchSyncBid=this.bindTo(q);this.logger=new e(f.id);this.abort=this.bindTo(r)}function k(a,b){if(m.isWindowHttps()&&!a.get("secure"))return d.reject(Error("Cannot place secure bid"));var e=a.get("placement_id"),f=(new c).build(a,b),g=a.get("maxduration");this.bidder=
a;this.fetcher=f;e=f.getOffer(b.context,b.reserve).then(this.bindTo(t,b,e));return h(g,e).otherwise(this.bindTo(n))}function q(a,b){if(m.isWindowHttps()&&!a.get("secure"))return{};var c=a.get("placement_id"),d=(new g).build(a,b);a.get("maxduration");this.bidder=a;this.fetcher=d;d=d.getOffer(b.context,b.reserve);return this.bindTo(t,b,c)(d)}function t(b,c,d){c=["offer.received",b.context.id,c].join(".");b=new a(d.price,d.context,b,this.bidder,d.displayer);p.fire(c,b);this.fetcher=null;return b}function n(a){a=
a instanceof Error?a:Error("bid fetcher timeout");this.logger.warn(b.DFP_REJECT_MESSAGE_RECEIVED,a.message);this.abort();throw a;}function r(){this.fetcher&&this.fetcher.abort();this.fetcher=null}l.prototype.bindTo=m.$bindTo;l.prototype.abort=function(){};return l});
BSM.define("model/bidder","when utils microdollar model/model bidder/manifest service/bidfetcher".split(" "),function(f,d,e,b,h,c){function g(a){this.offer({context:{adurl:""},price:new e(-1E3)});this.floor(0);for(var b in a){var c=a[b];if("null"!==typeof c||"undefined"!==typeof c)if("function"===typeof this[b])this[b](c);else this.set(b,c)}}g.prototype={abort:function(){this.fetcher&&this.fetcher.abort()},bias:1,bidder_type:"null",cacheable:!1,"default":!1,delivery_cap:{limit:Infinity,period:2592E6,
skips:null},flag:!1,flag_must_bid:!1,flag_page_only:!1,_floor:new e(0),floor:function(a){if(a)try{this.set("_floor",new e(a))}catch(b){this.set("_floor",new e(0))}return this.get("_floor")},invalid_cap:{limit:3,period:3E5,skips:3},maxduration:2E3,_offer:null,offer:function(a,b){return"object"===typeof a?this.set("_offer",a):"undefined"!==typeof a&&"undefined"!==typeof b?this.set("_offer",{context:{adurl:b},price:new e(a)}):this.get("_offer")},placement_id:"0",passback_cap:{limit:Infinity,period:2592E6},
_phase:"two",phase:function(){var a=["zero","one","two","three"];return function(b){b=isNaN(parseInt(b,10))?b:parseInt(b,10);null!=b&&("number"===typeof b&&b<a.length&&(b=a[b]),this.set("_phase",b));return this.get("_phase")}}(),platform:"unk",pricing_type:"first",priority:500,secure:!1,share:0,sendBidCall:function(a){this.fetcher=new c;return this.fetcher.fetchBid(this,a)},getOfferSync:function(a,b){this.fetcher=new c;return this.fetcher.fetchSyncBid(this,b)},shouldFetch:function(a){this.manifest||
(this.manifest=new h(this,this.get("platform"),a));var b;if(b=this.manifest.shouldFetch(a)){b=a.firstLook;var c=a.reprime;a=a.flag;var d=this.get("prefetch_only");b=!b&&!a&&!d||b&&(!d||d&&!c)||a&&!d}return b}};return g=b.extend(g)});
BSM.define("offer/null","impression offer microdollar when config utils offer/displayer/noop model/bidder".split(" "),function(f,d,e,b,h,c,g,a){function m(){var b=new f({}),c=new e(-1E3),h=new a({});d.call(this,c,{},b,h,new g)}m.prototype=c.inherit(d,{isClaimed:function(){return!1}});return m});
BSM.define("bid/selector","microdollar logger bid/ranker bid/pricer impression offer/null".split(" "),function(f,d,e,b,h,c){function g(a){this.offers=[];this.pricer=new b(a);this.ranker=new e(this.pricer);this.addOffer(new c);this._cleared=!1}g.prototype={_winner:null,_cleared:!1,ranker:null,offers:null,addOffer:function(a){this.offers.push(a);this.ranker.rank(a)},getCurrentWinner:function(){return this.ranker.getFirst()},getCurrentClearPrice:function(){return this.pricer.get(this._winner||this.ranker.getFirst(),
this.ranker.getSecond())},getClearPriceList:function(){for(var a=[],b=0,c=this.offers.length,d,e;b<c;b++)(d=this.offers[b])&&d.isValid()&&(e=this.ranker.getSecondByOffer(d),e=this.pricer.get(d,e),a.push({price:e.quantity(),platform:d.offeredBy.platform}));return a},clear:function(){if(this._winner&&this._winner.isValid())return this._winner;var a=this.ranker.getFirst(),b=this.pricer.get(a,this.ranker.getSecond());a.setPrice(b,!0);this.setWinner(a);return a},setWinner:function(a){this._winner=a;return this},
hasCleared:function(){return this._cleared},getWinner:function(){return this._winner},reclear:function(){this._cleared=!1;this._winner=null},find:function(a){a=a?a.toUpperCase():"";for(var b=this.offers,c=0,d=this.offers.length;c<d;++c)if(b[c].getPlatform().toUpperCase()===a)return b[c];return null}};return g});
BSM.define("bidder/factory",["model/bidder"],function(f){function d(d,b){d=d.get("priority");b=b.get("priority");return d-b}return function(e,b){return(e.bidders||[]).map(function(b){var c=b.flag,d=b.cacheable,d=e.firstLook&&d,c=e.flag&&c;if(e.isFirstLook()?d||c:1)return new f(b)}).sort(d)}});
BSM.define("auction/strategy/strategy",["module","logger","utils","when","logger/messages"],function(f,d,e,b,h){function c(a){if(!arguments.length)return this;var c=b.defer();this.resolver=c.resolver;this.promise=c.promise;this.resource=a;this.outstanding=[];this.aborted=!1;this.logger=new d(this.type,a.context.debug)}function g(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return a.splice(c,1)}c.prototype={aborted:!1,logger:null,outstanding:null,pending:null,promise:null,resolver:null,resource:null,
type:"super",bindTo:e.$bindTo,ask:function(){this.logger.error(h.ABSTRACT_METHOD_ERROR,f.id,"ask");throw Error("Ask not overridden by subclass");},start:function(a){if(!a.length)return b.resolve();this.pending=a.slice(0);this.ask();return this.promise},restart:function(){var a=b.defer();this.aborted=!1;this.resolver=a.resolver;this.promise=a.promise;return this.start(this.pending)},abort:function(){if(!this.aborted){var a=this.outstanding,b;for(this.aborted=!0;b=a.shift();)b.abort();this.resolver.resolve().done()}},
send:function(a){if(this.aborted)return this.aborted;this.outstanding.push(a);return a.sendBidCall(this.resource).then(this.bindTo(this.collect),this.bindTo(this.errorHandler,a))},errorHandler:function(a,b){g(this.outstanding,a);return this.done()?this.resolver.resolve():this.ask()},collect:function(a){var b=a.offeredBy;a.hasBid()?a.getPrice().getCPM():b.getFloor().getCPM();g(this.outstanding,b);return this.done()?this.resolver.resolve():this.ask()},done:function(){return this.aborted||0===this.outstanding.length&&
0===this.pending.length}};return c});BSM.define("auction/strategy/serial",["utils","./strategy","module"],function(f,d,e){function b(b){d.apply(this,arguments)}b.prototype=f.mixin(new d,{type:e.id,ask:function(){if(this.pending.length)return this.send(this.pending.shift())}});return b});
BSM.define("auction/strategy/dutch",["utils","./serial","module","logger/messages"],function(f,d,e,b){function h(a){d.apply(this,arguments)}function c(a,b){a=a.floor()&&a.floor().quantity()||Infinity;b=b.floor()&&b.floor().quantity()||Infinity;return b-a}var g=d.prototype.start,a=d.prototype.collect,m=d.prototype.done;h.prototype=f.mixin(new d,{type:e.id,finished:!1,done:function(){return this.finished||m.apply(this)},start:function(a){a=a.slice(0).sort(c);return g.call(this,a)},collect:function(b){b&&
b.isValid()&&(this.finished=!0);return a.call(this,b)}});return h});
BSM.define("auction/strategy/phase","require config utils when ./strategy module logger/messages".split(" "),function(f,d,e,b,h,c,g){function a(a){h.apply(this,arguments);this.strategies=d.get("auction/strategy/phase/strategy");this.pending=null}a.prototype=e.mixin(new h,{bidders:null,current:null,phases:null,strategies:null,type:c.id,ask:new Function,abort:function(){this.aborted=!0;this.current&&this.current.abort()},start:function(a){this.phases=["one","two","three"];for(var b={},c=a.length,d,
e,f=0;f<c;++f)e=a[f],d=e.phase(),d=b[d]=b[d]||[],d.push(e);this.bidders=b;return this.startPhase()},restart:function(){this.aborted=!1;return this.current&&this.current.pending.length?this.current.restart():this.startPhase()},startPhase:function(a){var c;if(!this.phases.length||this.aborted)return b.resolve();a?c=this.current.bidders:(c=this.getNextStrategy(),a=c[0],c=c[1]);return(this.current=a)?this.current.start(c).then(this.bindTo(this.clearPhase,this.phase,this.type)):this.startPhase()},getNextStrategy:function(){var a=
this.phase=this.phases.shift(),b=this.bidders[a]||[],a=this.type=this.strategies[a]||"parallel";if(!b.length)return[null,[]];var c=this.resource,d=f("./factory"),a=d?d(a,c):void 0;return[a,b]},clearPhase:function(a,b){return this.startPhase()}});return a});
BSM.define("auction/strategy/parallel",["utils","./strategy","module"],function(f,d,e){function b(b){d.apply(this,arguments)}b.prototype=f.mixin(new d,{type:e.id,ask:function(){for(var b=this.pending,c,d=b.length;d--;)c=b.shift(),this.send(c)}});return b});
BSM.define("auction/strategy/factory",["./dutch","./phase","./serial","./parallel"],function(f,d,e,b){var h={phase:d,dutch:f,serial:e,parallel:b};return function(b,d){if(!(b in h))return new TypeError(b+" not a valid strategy");var a=new h[b](d);a.type=b;return a}});
BSM.define("auction/builder","utils logger user bid/selector bidder/factory auction/strategy/factory microdollar".split(" "),function(f,d,e,b,h,c,g){var a=0;return function(f){var g=f.resource.context,l=g.getSoftFloor();f.floor=g.getFloor();e.initialize(g);f.logger=new d("auction/#"+ ++a,g.debug);var k;k=parseInt(g.maxduration,10);f.timeout=k;k=parseFloat(g.increment);f.incrementBidBy=k;f.bidders=h(g,f.biases);f.bidSelector=new b(l);f.strategy=c(g.strategy,f.resource)}});
BSM.define("manifest/slot",["module","config","manifest/manifest"],function(f,d,e){d=d.namespace(f.id);f=d.get("cache_key");d=d.get("expiry");return new e(f,d)});
BSM.define("auction/update_manifest",["module","config","manifest/slot"],function(f,d,e){var b=d.get("auction/update_manifest/cache_key_prefix");return function(d){var c=d.pub_zone.split("/")[0];d={pub:d.pub,zone_map_url:d.zone_map_url,site:c,size:d.sizes[0],sizes:d.sizes,pub_zone:d.pub_zone,position:d.position};c=[b,"/",d.pub,":",d.site,"@",d.size,"#",d.position].join("");return e.add(c,d)}});
BSM.define("auction/open",["module","auction/update_manifest","utils/msgs"],function(f,d,e){function b(b){var d=b.bidders;b=b.floor;for(var a=0,e=d.length;a<e;++a)b.gt(d[a].floor())&&d[a].floor(b)}var h=f.id.replace("/",".");return function(c){var f=c.resource.context,a=["offer.received",f.id],m=c.collect;c.startTime=(new Date).getTime();c.isNewSlot=d(f);b(c);e.listen(a,function(a){c.collect(a.detail.data)});e.fire(h,c);return c.strategy.start(c.bidders).then(c.check).then(c.clear).then(c.close).otherwise(c.error).ensure(function(){e.unlisten(a,
m)})}});BSM.define("auction/checkwinner",["when"],function(f){return function(d,e){if(!e.isClaimed())return f(e);d.logger.warn("offer claimed, refreshing it");return d.strategy.start([e.offeredBy]).then(d.check)}});
BSM.define("auction/collect",[],function(){return function(f,d){var e=d.bidSelector,b=d.incrementBidBy,h=d.resource,c=h.context,g=h.reserve;e.addOffer(f);var a;(a=f.mustFill()&&f.isValid())||(a=c.flag&&c.price_bar&&f.isValid()&&f.getPrice().quantity()>=Number(c.price_bar));a&&d.abort();e=e.getCurrentClearPrice();b=e.gte(g)?e.clone().multiplyBy(b):g;h.reserve=b;return f}});
BSM.define("auction/clear",["config","microdollar"],function(f,d){return function(e){var b=e.bidSelector,h=b.clear(),c=e.resource.context;h&&h.isValid()||(h=f.get("auction/default_bidder"),b=b.find(h),c.getFloor().quantity(),b&&b.canDisplay()&&!b.isClaimed()?(b.setPrice(new d(0)),b.passback=!0,h=b):h=null);if(!h)throw Error("cannot clear auction without valid winner");e.clearedPrice=h.getPrice();h.claim();return h}});
BSM.define("model/event/nucleus/priceupdate",[],function(){function f(d){for(var e in f.prototype)e in d&&(this[e]=d[e]);this.event_key&&(this.event_name="nucleus.priceupdate."+this.event_key)}f.prototype={slot_key:"",gross_offer:"",platform_name:"",pricing_type:"",price_list:[],pending_bidders:[],impression:null,targeting_key:""};f.prototype.event_name="nucleus.priceupdate";f.prototype.event_key="";return f});
BSM.define("model/event/nucleus/complete",[],function(){function f(d){for(var e in f.prototype)e in d&&(this[e]=d[e]);this.event_key&&(this.event_name="nucleus.complete."+this.event_key)}f.prototype={slot_key:"",duration:0,price_list:[],impression:null};f.prototype.event_name="nucleus.complete";f.prototype.event_key="";return f});
BSM.define("nucleus","utils utils/msgs when config impression user/cache auction/builder auction/open auction/collect model/event/nucleus/priceupdate model/event/nucleus/complete".split(" "),function(f,d,e,b,h,c,g,a,m,p,l){function k(a,b){var d=a.context;d.firstLook=!0;d.strategy="parallel";d.soft_floor=d.fl_soft_floor;this.resource=a;this.pageSlots=b||[];this.slotSuffix=d.positionIndex;this.cacheKey=this.bindTo(function(){return v(this.resource.context.sizes[0],"price",this.slotSuffix)});this.bidCacheKey=
this.bindTo(function(){return v(this.resource.context.sizes[0],"bids",this.slotSuffix)});this.prevList=c(this.bidCacheKey()).value()||[];this.collect=this.bindTo(t);this.check=this.bindTo(n);this.clear=this.bindTo(r);this.close=this.bindTo(u);g(this);B(this.bidders,this)}function q(a,b){function c(){d.pubads().setTargeting(a,b)}var d=A(),e=d.cmd;e.splice?e.splice(0,0,c):e.push(c)}function t(a){m(a,this);var b=a.offeredBy.platform;this.checkPreviousList(b);var e=this.bidSelector.getClearPriceList(),
e=e.concat(this.prevList.slice(0));c(this.bidCacheKey()).value(e).expire(z.get("prices_expiration")).save();for(var g=this.resource.context,h=this.bidders,k=[],l=0,n=h.length;l<n;++l)h[l].hasCompleted||h[l].platform===b||k.push(h[l]);h=[];l=0;for(n=k.length;l<n;++l)h.push(k[l].platform);l=g.getSlotKey();e=this.getPriceNumbers(e);n=this.getPriceStrings(e);d.fire(new p({event_key:l,slot_key:l,gross_offer:a.getGrossPrice().quantity(),platform_name:b,pricing_type:a.getPricingType(),price_list:e,pending_bidders:h,
impression:g,targeting_key:this.publisherTargetingKey()}));y(this.cacheKey(),n);b=this.pageSlots;g=[];e=z.get("prefix");h=0;for(l=b.length;h<l;++h){var n=b[h],t=n.pos,r=n.size.replace("x",""),n=void 0,n=t;"undefined"===typeof n&&(n="0");var n=r+"."+n,u=void 0,u=v(r,"price",t),u=c(u).value(),t=[];if(u)for(var r=0,x=u.length;r<x;++r)t.push(n+"."+u[r]);g=g.concat(t)}f.dedupe(g);y([e,"cxprices"].join("/"),g);q("cxprices",g);B(k,this);return a}function n(a){var b=this.bidSelector.getClearPriceList(),c=
this.resource.context.getSlotKey(),f=(new Date).getTime()-this.startTime,b=this.getPriceNumbers(b);d.fire(new l({event_key:c,slot_key:c,duration:f,price_list:b,impression:this.resource.context}));return e.resolve(a)}function r(){return this.bidSelector.clear()}function u(){return this}function v(a,b,c){b="price"===b?z.get("price_cache_prefix"):z.get("bid_cache_prefix");a=z.get("prefix")+a.replace("x","");c&&"0"!==c&&(a+="."+c);return[b,a].join("/")}function y(a,b){c(a).value(b).expire(z.get("prices_expiration")).save()}
function w(a,b){for(var c=z.get("increments"),d=0,e=b.length;d<e;d++)a===b[d]&&(a-=c);return a}function A(){var a=window;return a.googletag=a.googletag||{cmd:[]}}function B(a,b){F(a)&&!b.ready&&(d.fire(["nucleus.ready"]),b.ready=!0)}function F(a){return f.all(function(a){return!a.get("flag_must_bid")},a)}function x(a){var b=z.get("prefix")+"/enabled";c(b).value(a).expire(432E5).save()}var z=b.namespace("flag");k.prototype={bidSelector:null,bidders:null,floor:null,incrementBidBy:0,logger:null,pageSlots:null,
resource:null,slotSuffix:0,strategy:null,ready:!1,timeout:0,bindTo:f.$bindTo,start:function(){z.get("enabled")?(x(!0),a(this)):x(!1)},abort:function(){return this.strategy.abort()},publisherTargetingKey:function(){var a=z.get("prefix")+this.resource.context.sizes[0].replace("x",""),b=this.slotSuffix;b&&(a+="."+b);return a},getPriceNumbers:function(a){var b=[a.length],c,d;c=this.resource.context;var e=z.get("increments"),g=c.flag_ceiling||z.get("ceiling");a.sort(function(a,b){return b.price-a.price});
for(c=0;c<a.length;c++)d=f.roundToIncrement(a[c].price,e,g),d=w(d,b),0<d&&b.push(d);b.sort(function(a,b){return b-a});return b},getPriceStrings:function(a){for(var b=[],c=0,d=a.length;c<d;c++)b.push(""+a[c]);return b},checkPreviousList:function(a){for(var b=0;b<=this.prevList.length;b++){var c=this.prevList[b];c&&c.platform===a&&this.prevList.splice(b,1)}}};k.open=function(a,b){var c=new h(a);return(new k(c,b)).start()};return k});
BSM.define("auction","when utils utils/msgs window document impression microdollar impression/adjuster auction/synchronous auction/databus/sendevent auction/builder auction/open auction/checkwinner auction/collect auction/clear auction/update_manifest nucleus user/session logger/messages".split(" "),function(f,d,e,b,h,c,g,a,m,p,l,k,q,t,n,r,u,v,y){function w(a){this.resource=a;this.defer=f.defer();this.collect=this.bindTo(B);this.check=this.bindTo(F);this.clear=this.bindTo(x);this.close=this.bindTo(z);
this.error=this.bindTo(C);this.reconcile=this.bindTo(G);this.onRevoked=this.bindTo(H);this.onTimeout=this.bindTo(A);l(this);e.listen(["offer.revoked",this.resource.context.id],this.onRevoked);e.listen(["offer.update",this.resource.context.id],this.reconcile);v.incAuctionCount(this.resource.context)}function A(){this.hasWinner()?(this.logger.error(y.AUCTION_TIMEOUT),this.abort()):this.auctionTimer=setTimeout(this.onTimeout,this.timeout)}function B(a){return t(a,this)}function F(){var a=this.resource.context.id,
b=this.logger.prefix,c=this.bidSelector.getCurrentWinner();if(!c)throw Error(b+":"+a+":asked to check winner but no offers available");return q(this,c)}function x(){var a=n(this),b=["offer.displayed",this.resource.context.getSlotKey()],c=this.startTime,d={winner:a.offeredBy.platform,impression:this.resource,placement_id:a.offeredBy.get("placement_id"),flag:this.resource.context.flag||!1,price:this.clearedPrice.quantity(),injection_type:a.displayer.type,session:this.resource.context.session};e.listen(b,
function L(){e.unlisten(b,L);d.duration=(new Date).getTime()-c;p("filled",d)});this.duration=(new Date).getTime()-this.startTime;clearTimeout(this.auctionTimer);return this.winner=a}function z(){this.duration=(new Date).getTime()-this.startTime;this.winner.display(this.resource.context);this.sendNotification();p(!0===this.winner.passback?"passback":"cleared",this);var a;if(!(a=this.resource.context.flag)){a=b;for(var c=!1;a.parent!=a&&!c;){a=a.parent;try{c=a.BSM&&a.BSM.nucleusVersion}catch(d){}}a=
c&&this.isNewSlot}a&&(a=this.resource,a.context.flag=!1,a.context.reprime=!0,(new u(a)).start());return this}function C(a){this.duration=(new Date).getTime()-this.startTime;clearTimeout(this.auctionTimer);this.error=a;p("error",this);return f.reject(a)}function G(a){if(!this.winner.passback){var b=a.winner;a=a.price;p("revoked",this);b&&this.winner.offeredBy.setPlatform(b);a&&(b=new g(a),this.winner.setPrice(b),this.clearedPrice=b);p("cleared",this)}}function H(){var a=this.winner;p("revoked",this);
a.revoke();this.resource.reserve=this.bidSelector.getCurrentClearPrice();this.strategy.restart().then(this.clear).then(this.close).otherwise(this.error)}function E(){var a=h.readyState;return!a||"complete"===a||"loaded"===a}w.prototype={constructor:w,adjuster:null,auctionTimer:0,biases:null,bidders:null,bidSelector:null,clearedPrice:null,defer:null,duration:0,floor:null,incrementBidBy:0,logger:null,winningOffers:null,resource:null,startTime:0,strategy:null,timeout:0,bindTo:d.$bindTo,open:function(){var b=
this.defer.resolver;this.auctionTimer=setTimeout(this.onTimeout,this.timeout);this.adjuster=new a(this);k(this).then(b.resolve,b.reject);return this.defer.promise},openSync:function(){return m(this)},getTimeout:function(){return parseInt(this.resource.context.maxduration,10)},hasWinner:function(){return 0<this.bidSelector.getCurrentClearPrice().quantity()},abort:function(){this.strategy.abort()},sendNotification:function(){var a=this.winner.getNotifyUrl(),b=this.resource.context.container,c;a&&(c=
h.createElement("iframe"),c.width=c.height=c.frameBorder=0,c.style.visibility="hidden",c.setAttribute("src",a),b.appendChild(c))},getBidder:function(a){for(var b=this.bidders,c=!1,d=0;d<this.bidders.length;d++)b[d].platform.toLowerCase()===a&&(c=b[d]);return c}};w.open=w.openAuction=function(a){v.incStartCount();var b=new c(a),b=new w(b);a=a.sync?!E():!1;a||(a=b.bidders&&1===b.bidders.length?(a=b.bidders[0])&&"apn"===String(a.platform).toLowerCase()?!E():!1:!1);return a?b.openSync():b.open()};return w});
BSM.define("auction/registry",["module","logger","utils/msgs"],function(f,d,e){var b={},h=new d(f.id);e.listen("auction.open",function(c){c=c.detail.data;var d=c.resource.context.id;d in b&&h.warn("double open for auction "+d);d&&(b[d]=c)});return function(c){return b[c]}});
BSM.define("utils/frame_locator",["module","logger","window","document"],function(f,d,e,b){function h(a,b){var d,e=-1;try{d=b.frames,e=d.length}catch(f){c.warn("unable to access frame list of win")}for(var g=0;g<e;g++){var t=d[g];if(t==a||~h(a,t))return g}return-1}var c=new d(f.id),g=b.getElementsByTagName("iframe");return function(a){if(a==e)return b.documentElement;a=h(a,e);a=window.frames[a];for(var c,d=0,f=g.length;d<f;d++){try{c=g[d].contentWindow}catch(k){continue}if(a==c)return g[d]}return!1}});
BSM.define("utils/mercury","module window document config logger utils utils/msgs utils/frame_locator".split(" "),function(f,d,e,b,h,c,g,a){function m(b){b=b||k.event;var d=b.data,e=t.get("msg_data_regex");b=b.source;var f;if(!("string"!=typeof d||0>d.indexOf(e))){element=a(b);e=(b=p(element))&&b.id;var h=t.get("msg_data_regex");if(d=d.substr(h.length).match(/^([^=]+)=?(.*)/)){try{f=JSON.parse(d[2])}catch(l){f={value:d[2]}}d={type:d[1],value:f}}else d=void 0;f=d.value;d=[d.type];c.mergeDefaults(f,
b);e&&d.push(e);g.fire(d,f)}}function p(a){var b,c=r.length;if(!a)return null;do{if(b=a.id&&a.id.substr(0,c)===r?a.id:a.getAttribute(n))return a=l(a),a.id=b,a;a=a.parentNode}while(a!=q);return null}function l(a){var b={};t.get("data_attribute_keys").forEach(function(c){var d=c.replace(/\-.*/,"");b[d]=a.getAttribute("data-"+c)});return b}var k=d,q=e;new h(f.id);var t=b.namespace(f.id),n=t.get("id_attribute_name"),r=t.get("cx_id_prefix");k.addEventListener?k.addEventListener("message",m,!0):k.attachEvent&&
k.attachEvent("onmessage",m)});BSM.define("main",["logger","logger/messages","auction","auction/registry","utils/mercury"],function(f,d){function e(b){if("function"==typeof b)try{b()}catch(e){h.error(d.ERROR_RUNNING_COMMAND,e)}}var b=(window.bsm_tag=window.bsm_tag||{run:[]}).run||[],h=new f("main.js");b.push=function(b){return e(b)};(function(){for(var c;c=b.shift();)e(c)})();return b});
BSM.define("model/nucleus/nucleus_element",["document"],function(f){a:{f=f.querySelectorAll("img,script");for(var d=f.length,e;d--;)if(e=f[d],e.getAttribute("data-bsm-flag")){f=e;break a}f=void 0}return f});
BSM.define("controller/nucleus/notifier","module impression/positionmap utils utils/msgs utils/custom_dom_event model/nucleus/nucleus_element".split(" "),function(f,d,e,b,h,c){function g(a){var b=a.detail.data,c=b.impression;a=b.gross_offer;var e=b.platform_name,f=b.pricing_type,b=b.price_list,g=d[c.positionIndex||0],h=c.sizes[0],c=c.site,l=[h.replace("x",""),c,g].join(".");p("onBidResponse",k,{gross_price:a,platform:{name:e,clear_type:f},resource:{id:l,size:h,site:c,position:g},clear_prices:b})}
function a(a){a=a.detail.data.resource.context;var b=a.id;a.firstLook&&!~q.indexOf(b)&&(q.push(b),q[b]=!0)}function m(a){var b=a.detail.data;a=b.duration;var c=b.impression,e=b.price_list,f=d[c.positionIndex||0],g=c.sizes[0],c=c.site,h=[g.replace("x",""),c,f].join("."),b=b.impression.id;p("onResourceComplete",k,{prices:e,duration:a,resource:{id:h,size:g,site:c,position:f},clear_prices:e});~q.indexOf(b)&&(q.splice(q.indexOf(b),1),0===q.length&&p("onNucleusComplete",k))}function p(a,b,c){a=new h(a,
{bubbles:!1,cancelable:!1,detail:c});b.dispatchEvent(a)}var l=!1,k=c,q=[];return{init:function(){l||(l=!0,b.listen("auction.open",a),b.listen("nucleus.priceupdate",g),b.listen("nucleus.complete",m))}}});
BSM.define("controller/nucleus/gpt/restore",["module","window","utils/msgs","config"],function(f,d,e,b){function h(a){p++;p>=m&&c()}function c(){var a=(window.googletag||g).cmd;a.restore&&a.restore();d.clearTimeout(l)}var g={cmd:[]},a=!1,m=0,p=0,l;return{init:function(g){if(!a){a=!0;var p=b.namespace(f.id).get("timeout");l=d.setTimeout(c,p);m=g;e.listen("nucleus.ready",h)}}}});
BSM.define("model/nucleus/auction_result",["module"],function(f){function d(d){this.initialize();this.slotKey(d)}f={slot_key:String,impression:Object,received_prices:Array,targeted_prices:Array,duration:Number,bids:Object};d.prototype.toJSON=function(){var d={},b;for(b in this.__values__)d[b]=this.__values__[b];return d};return function(d,b){function f(b){b=b.replace(/[\-_\s]+(.)?/g,function(a,b){return b?b.toUpperCase():""});return b.substr(0,1).toLowerCase()+b.substr(1)}function c(b){return function(a){if(!a)return this.__values__[b];
this.__values__[b]=a;return this}}Object.keys(b).forEach(function(b,a){var m=f(b);d.prototype[m]=c(b)});d.prototype.initialize=function(){var c={};Object.keys(b).forEach(function(a){c[a]=new b[a]});this.__values__=c};return d}(d,f)});
BSM.define("controller/data_bus/nucleus_result","module utils utils/msgs model/nucleus/auction_result eventlogger config".split(" "),function(f,d,e,b,h,c){function g(){if(k)return k;k=this;this.results={};this.pending=[];this.gptDisplayed=!1}function a(a){a=(a.detail||{}).data||{};var b=a.slot_key,c=this.getResult(b),d=c.bids();c.receivedPrices(a.price_list);d[a.platform_name]=a.gross_offer;c.bids(d);c.impression(a.impression);c.slotKey(b)}function m(a){a=(a.detail||{}).data||{};var b=this.getResult(a.slot_key);
b.duration(a.duration);b.receivedPrices(a.price_list);this.auctionComplete(b)}function p(a){if(!this.gptDisplayed){this.gptDisplayed=!0;for(var b in this.results)with(this.getResult(b))targetedPrices(receivedPrices().slice(0));this.flushSendQueue()}}var l=c.namespace(f.id),k;g.prototype={initialize:function(){e.listen("nucleus.priceupdate",this.bindTo(a));e.listen("nucleus.complete",this.bindTo(m));e.listen("gpt.display",this.bindTo(p));setTimeout(this.bindTo(p),l.get("gpt_timeout"));return this},
getResult:function(a){var c=this.results[a]||new b(a);return this.results[a]=c},auctionComplete:function(a){this.gptDisplayed?h("nucleus",a.toJSON()):this.pending.push(a)},flushSendQueue:function(){for(var a;a=this.pending.shift();)h("nucleus",a.toJSON())},bindTo:d.$bindTo};g.init=function(){return(new g).initialize()};return g});
BSM.define("utils/jsonp",["when","window","utils/script"],function(f,d,e){return function(b,h,c){var g=f.defer(),a=g.promise,m=g.resolver;d[c]=function(a){d[c]=void 0;m.resolve(a)};e(b+"&"+h+"="+c);return a}});
BSM.define("model/slot",["utils","impression/positionmap","model/model"],function(f,d,e){function b(b){"undefined"===typeof b.pos&&(this.pos=d[b.position]);"undefined"===typeof b.size&&(this.size=b.sizes[0]);for(var c in b){var e=b[c];if("null"!==typeof e||"undefined"!==typeof e)if("function"===typeof this[c])this[c](e);else this.set(c,e)}}b.prototype={id:"",pub:"",pub_zone:"",sizes:["1x1"],size:"1x1",position:"unknown",pos:0,toJSON:function(){return{id:this.id,pub:this.pub,pub_zone:this.pub_zone,
sizes:this.sizes,size:this.size,position:this.position,pos:this.pos}}};return b=e.extend(b)});
BSM.define("nucleus/loader","when nucleus manifest/slot config document impression/positionmap model/nucleus/nucleus_element controller/nucleus/notifier controller/nucleus/gpt/restore controller/data_bus/nucleus_result auction/update_manifest impression manifest/bidderkeygen manifest/manifest utils utils/jsonp model/slot user".split(" "),function(f,d,e,b,h,c,g,a,m,p,l,k,q,t,n,r,u,v){function y(a,b){var c=b.slots.map(function(c){c.bidders=(c.bidders||[]).map(function(a){return b.bidders[a]});c=new k(c);
var e=new d(c,a);A(c);return e});c.map(function(a){return a.start()});return c}function w(a){for(var b={},c=B.get("tag_attributes"),d="",e="",f=0,g=c.length;f<g;f++)d=c[f],e=a.getAttribute("data-bsm-"+d),d=d.replace(/-/g,"_"),b[d]=e;b.position="unknown";return b}function A(a){for(var b=a.context.bidders||[],c,d=b.length-1;0<=d;d--)c=b[d],!0===c.flag_page_only&&(c=q(c.placement_id,a.context),c=new t(c),c.remove());return a}var B=b.namespace("flag/loader");return function(){var c,d;if(g){d=g.getAttribute("data-bsm-sizes");
d=(d||"728x90,300x250").split(/[,\s;]+/g);for(var f=[],h=0,k=d.length;h<k;h++)c=w(g),c.sizes=[d[h]],f.push(c);d=f}else d=[];f=0;for(c=d.length;f<c;f++)l(d[f]);c=e.entries();a.init();p.init();m.init(c.length);d=[];for(var h=c.length,f="nuke"+Math.floor(1E12*Math.random()).toString(36),q=0;q<h;q++)k=new u(c[q]),k.firstLook=!0,k.id="slot"+Math.floor(1E12*Math.random()).toString(36),d.push(k);c=w(g).event_host+"/nucleus/request?";h=JSON.stringify(d);k=JSON.stringify({u:v.getId(),s:v.getSessionId(),pv_id:v.getPageViewId()});
h=["v="+b.get("version"),"slots="+encodeURIComponent(h),"user="+encodeURIComponent(k)];c+=h.join("&");return r(c,"cb",f).then(n.$bindTo(y,d))}});BSM.define("cx",function(){});BSM.require(["main"]);
